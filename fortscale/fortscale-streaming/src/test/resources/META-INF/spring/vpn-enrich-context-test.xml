<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:mongo="http://www.springframework.org/schema/data/mongo"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:mockito="http://www.mockito.org/spring/mockito"
	   xsi:schemaLocation="http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
	   			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
				http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
				http://www.mockito.org/spring/mockito http://www.mockito.org/spring/mockito.xsd">


	<context:spring-configured />
    <context:annotation-config />
	<context:component-scan base-package="fortscale.geoip,fortscale.domain.schema,fortscale.streaming.service.vpn"/>

	<bean class="org.springframework.context.support.PropertySourcesPlaceholderConfigurer">
		<property name="location" value="classpath:META-INF/fortscale-config.properties"/>
		<!--<property name="order" value="#{T(org.springframework.core.Ordered).HIGHEST_PRECEDENCE}"/>-->
		<property name="ignoreUnresolvablePlaceholders" value="true"/>
		<!--<property name="localOverride" value="true"/>-->
	</bean>
    

    <bean class="org.springframework.context.support.PropertySourcesPlaceholderConfigurer">
        <property name="location" value="classpath:fortscale-overriding-streaming-test.properties"/>
        <property name="order" value="#{T(org.springframework.core.Ordered).HIGHEST_PRECEDENCE}"/>
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <property name="localOverride" value="true"/>
    </bean>

	<bean id="vpnGeolocationConfig" class="fortscale.streaming.service.vpn.VpnGeolocationConfig">
		<constructor-arg name="ipField" value="ip_field"/>
		<constructor-arg name="countryFieldName" value="country_field"/>
		<constructor-arg name="countryIsoCodeFieldName" value="country_code_field"/>
		<constructor-arg name="regionFieldName" value="region_field"/>
		<constructor-arg name="cityFieldName" value="city_field"/>
		<constructor-arg name="ispFieldName" value="isp_field"/>
		<constructor-arg name="usageTypeFieldName" value="usage_type_field"/>
		<constructor-arg name="longtitudeFieldName" value="longtitude_field"/>
		<constructor-arg name="latitudeFieldName" value="latitude_field"/>
	</bean>
	<bean id="vpnDataBucketsConfig" class="fortscale.streaming.service.vpn.VpnDataBucketsConfig">
		<constructor-arg name="totalbytesFieldName" value="totalbytesFieldName"/>
		<constructor-arg name="readbytesFieldName" value="readbytesFieldName"/>
		<constructor-arg name="durationFieldName" value="durationFieldName"/>
		<constructor-arg name="databucketFieldName" value="databucketFieldName"/>
	</bean>
	<bean id="vpnSessionUpdateConfig" class="fortscale.streaming.service.vpn.VpnSessionUpdateConfig">
		<constructor-arg name="countryIsoCodeFieldName" value="country_field"/>
		<constructor-arg name="longtitudeFieldName" value="longtitude_field"/>
		<constructor-arg name="latitudeFieldName" value="latitude_field"/>
		<constructor-arg type="int" name="vpnGeoHoppingOpenSessionThresholdInHours" value="6"/>
		<constructor-arg type="int" name="vpnGeoHoppingCloseSessionThresholdInHours" value="1"/>
		<constructor-arg name="sessionIdFieldName" value="session_id_field"/>
		<constructor-arg name="runGeoHoppingFieldName" value="false"/>
		<constructor-arg name="addSessionDataFieldName" value="true"/>
		<constructor-arg name="resolveIpFieldName" value="true"/>
		<constructor-arg name="dropCloseEventWhenOpenMissingFieldName" value="false"/>
		<constructor-arg name="timeGapForResolveIpFrom" value="30"/>
		<constructor-arg name="timeGapForResolveIpTo" value="30"/>


	</bean>
	<bean id="testStreamingTaskDataSourceConfigKey" class="fortscale.streaming.service.config.StreamingTaskDataSourceConfigKey">
		<constructor-arg name="dataSource" value="datasource1"/>
		<constructor-arg name="lastState" value="laststate1"/>
	</bean>

	<bean id="vpnEnrichConfig" class="fortscale.streaming.service.vpn.VpnEnrichConfig">
		<constructor-arg name="streamingTaskDataSourceConfigKey" ref="testStreamingTaskDataSourceConfigKey"/>
		<constructor-arg name="outputTopic" value="output-1"/>
		<constructor-arg name="partitionField" value="partition-1"/>
		<constructor-arg name="vpnGeolocationConfig" ref="vpnGeolocationConfig"/>
		<constructor-arg name="vpnDataBucketsConfig" ref="vpnDataBucketsConfig"/>
		<constructor-arg name="vpnSessionUpdateConfig" ref="vpnSessionUpdateConfig"/>
		<constructor-arg name="usernameFieldName" value="username"/>
	</bean>
	<bean id="vpnEnrichService" class="fortscale.streaming.service.vpn.VpnEnrichService">
		<constructor-arg name="config" ref="vpnEnrichConfig"/>
	</bean>

	<bean class="fortscale.streaming.service.vpn.MockEvidencesRepository"/>
	<bean class="fortscale.services.impl.UserSupportingInformationServiceImpl"/>
	<bean class="fortscale.services.impl.EvidencesServiceImpl"/>



</beans>
