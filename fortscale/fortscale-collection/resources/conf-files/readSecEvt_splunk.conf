morphlines : [
{
	id : morphline1
	importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]

    commands : [
		{
	  		split {
	  			inputField : message
				outputFields : [categoryString,eventCode,logfile,messageData,recordNumber,sourceName,timeGenerated,computerName]
				separator : "|"
	  		}
	  	}
	  	{
			tryRules {
		  		catchExceptions : true
		  		throwExceptionIfAllRulesFailed : false
		  		rules : [
				{
			  		commands : [
	  				{
						grok {
		  					dictionaryString : """
								ACCOUNT_NAME ((?<=Account Name:\s)|(?<=Account Name:\s\s))[\w\S ]+
							  	ACCOUNT_DOMAIN ((?<=Account Domain:\s)|(?<=Account Domain:\s\s))[\w\S ]+
								SERVICE_NAME ((?<=Service Name:\s)|(?<=Service Name:\s\s))[\w\S ]+
								SERVICE_ID ((?<=Service ID:\s)|(?<=Service ID:\s\s))[\w\S ]+
								CLIENT_ADDRESS ((?<=Client Address:\s)|(?<=Client Address:\s\s))[\w\S ]+
								TICKET_OPTIONS ((?<=Ticket Options:\s)|(?<=Ticket Options:\s\s))[\w\S ]+
								FAILURE_CODE ((?<=Failure Code:\s)|(?<=Failure Code:\s\s))[\w\S ]+
								SOURCE_NETWORK_ADDRESS ((?<=Source Network Address:\s)|(?<=Source Network Address:\s\s))[\w\S ]+
								 """
		  					findSubstrings : true
						  	addEmptyStrings : true
						  	numRequiredMatches : all
						  	expressions : {
								messageData : "%{ACCOUNT_NAME:account_name}|%{ACCOUNT_DOMAIN:account_domain}|%{SERVICE_NAME:service_name}|%{SERVICE_ID:service_id}|%{CLIENT_ADDRESS:client_address}|%{TICKET_OPTIONS:ticket_options}|%{FAILURE_CODE:failure_code}|%{SOURCE_NETWORK_ADDRESS:source_network_address}"
						  	}
						}
      				}
			  		]
				}
		  	]
			}
	  }
	  {
			addValues {
				timeGeneratedRaw : "@{timeGenerated}"
				timeGeneratedUnixTime : "@{timeGenerated}"
			}
	  }
	  {
			tryRules {
		  		catchExceptions : true
		  		throwExceptionIfAllRulesFailed : false
		  		rules : [
				{
			  		commands : [
      					{
        					java {
          						imports : "import java.util.*;"
          						code: """
                					Object rec = record.getFirstValue("timeGenerated");
                					String tmp = String.valueOf(rec).substring(0,19);
                					record.replaceValues("timeGenerated",tmp);
                					return child.process(record);
                					"""
        					}
      					}
      					{
        					java {
          						imports : "import java.util.*;"
          						code: """
                					Object rec = record.getFirstValue("timeGeneratedUnixTime");
                					String tmp = String.valueOf(rec).substring(0,19);
                					record.replaceValues("timeGeneratedUnixTime",tmp);
                					return child.process(record);
                					"""
        					}
      					}              
                  		{
			    			convertTimestamp {
			    	  			field : timeGenerated
                      			#2013-11-05T17:59:57.000+02:00
			    	  			inputFormats : ["yyyy-MM-dd'T'HH:mm:ss"]
			    	  			inputTimezone : IST
			    	  			outputFormat : "yyyy-MM-dd HH:mm:ss"
		    	  				outputTimezone : IST
			    			}
				  		}
				  		{
							convertTimestamp {
					  			field : timeGeneratedUnixTime 
			    	  			inputFormats : ["yyyy-MM-dd'T'HH:mm:ss"]
					  			inputTimezone : UTC
					  			outputFormat : "unixTimeInSeconds"
					  			outputTimezone : UTC
							}
				  		}
			  		]
				}
		  		]
			}
	  	}
	  	{
			tryRules {
		  		catchExceptions : true
		  		throwExceptionIfAllRulesFailed : false
		  		rules : [
				{
			  		commands : [
				  		{
							findReplace {
					  			field : client_address
					  			pattern : "::1"
					  			isRegex : false
					  			replacement : "127.0.0.1"
					  			replaceFirst : false
							}
				  		}
				  		{
							findReplace {
					  			field : client_address
					  			pattern : "::ffff:"
					  			isRegex : false
					  			replacement : ""
				  				replaceFirst : false
							}
				  		}
					]
				}
		  		]
			}
	  	}
	]
  }
]
