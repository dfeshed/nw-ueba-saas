# Morphline file that parse ISE events into canonical format

morphlines : [
  {
    id : parseISE
    importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]

    commands : [

      {logDebug {format: "Debug -1 : {}", args: ["@{}"]}}
				{
                  # filter  message by specific event codes"
                  # all other will be discarded in the dropRecord command bellow

          split {
            inputField : message
            outputFields : [raw_time,timestampepoch,eventCode,hostname,ipaddress,macAddress]
            separator : ","
          }

        }

      {logDebug {format: "Debug -2 : {}", args: ["@{}"]}}

      # drop events with missing ip or hostname
      {
        EmptyObjectFilter {
          filterFields : [timestampepoch,eventCode,ipaddress,hostname]
        }
      }

      {logDebug {format: "Debug -3 : {}", args: ["@{}"]}}





		# drop events that are not 3000, 3001 or 3002
        {
			if {
				conditions : [
					{ not {contains { eventCode : ["3000", "3001", "3002"] } }}
				]
				then : [
				    { LogFilterEvent { errorMessage: "Event Code is not 3000,3001, 3002"}}
					{ dropRecord {} }
				]
			}
		}

      {logDebug {format: "Debug -4 : {}", args: ["@{}"]}}

		# convert event time to utc timestamp
		{
			convertTimestampFortscale {
			  field : timestampepoch
			  outputFormat : "unixTimeInSeconds"

			}
		}

      {logDebug {format: "Debug -5 : {}", args: ["@{}"]}}

      # check if the hostname is in AD
      {
        IsADComputer {
          hostnameField : "hostname"
          outputField : "adHostName"
        }
      }

      {logDebug {format: "Debug -6 : {}", args: ["@{}"]}}
	]
  }
]
