# Morphline file that parse ISE events into canonical format
#Example:
# Mon Dec 14 14:30:12 IST 2015,192.168.0.81,zehavitv
morphlines: [
  {
    id: parsePxGrid
    importCommands: ["org.kitesdk.morphline.**", "org.apache.solr.**", "fortscale.collection.morphlines.**"]

    commands: [
      {logDebug {format: "Debug -1 : {}", args: ["@{}"]}}
      {
        split {
          inputField: message
          outputFields: [createdAt, ipaddress, hostname]
          separator: ","
        }
      }
      {logDebug {format: "Debug -2 : {}", args: ["@{}"]}}
      # drop events with missing ip or hostname
      {
        EmptyObjectFilter {
          filterFields: [createdAt, ipaddress, hostname]
        }
      }
      {logDebug {format: "Debug -3 : {}", args: ["@{}"]}}
      {
        addValues {
          timestampepoch: "@{createdAt}"
        }
      }
      {logDebug {format: "Debug -4 : {}", args: ["@{}"]}}
      # convert event time to utc timestamp
      {
        convertTimestampFortscale {
          field: timestampepoch
          outputFormat: "unixTimeInSeconds"

        }
      }
      {logDebug {format: "Debug -5 : {}", args: ["@{}"]}}
      # check if the hostname is in AD
      {
        IsADComputer {
          hostnameField: "hostname"
          outputField: "adHostName"
        }
      }
      {logDebug {format: "Debug -6 : {}", args: ["@{}"]}}
    ]
  }
]