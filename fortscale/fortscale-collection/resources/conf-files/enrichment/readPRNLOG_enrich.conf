morphlines : [
  {
    id : prnlogEnrich
    importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]
    commands : [


      {
       setValues {
         data_source : ["prnlog"]
         last_state : ["etl"]
         date_time_unix:"@{date_time}"
       }
     }





     {
       convertTimestampFortscale {
         field : date_time
         inputFormats : ["yyyy-MM-dd'T'HH:mm:ss"]
         outputFormat : "yyyy-MM-dd HH:mm:ss"
       }
     }

     {
       convertTimestampFortscale {
         field : date_time_unix
         inputFormats : ["yyyy-MM-dd'T'HH:mm:ss"]
         outputFormat : "unixTimeInSeconds"
       }
     }

     {
             # If the source_ip is ip address, set the hostname to be empty, and do nothing
             # if the source_ip is not ip address,
             # so it's computer name, set the value into "hostname" field, and reset "source_ip" to be empty
             java {
               imports : "import java.util.*;import org.apache.commons.validator.routines.*;"
               code: """
                     Object sourceIp = record.getFirstValue("source_ip");
                     //System.out.println("shay"+sourceIp);
                     if ((sourceIp != null) && (sourceIp instanceof String)) {
                         InetAddressValidator ipValidator = InetAddressValidator.getInstance();
                         boolean isIpAddress = ipValidator.isValid((String)sourceIp);

                         if (isIpAddress){
                             //Set empty hostname
                             record.put("hostname","");
                         } else {
                             //set hostname with the value of the source ip, and make source_ip empty
                             record.put("hostname",sourceIp);
                             record.replaceValues("source_ip","");
                         }
                     }


                     return child.process(record);
                     """
             }
         }

    ]
  }
]
