morphlines: [
  {
    id: verdasysParsing
    importCommands: ["org.kitesdk.morphline.**", "org.apache.solr.**", "fortscale.collection.morphlines.**"]

    commands: [

      {logDebug {format: "Debug -1 : {}", args: ["@{}"]}}

      # parse the raw message, extract all fields from the message, assuming the following format:
      # "2016.04.04","4/4/2016 9:31:15 AM","4/4/2016 1:31:15 PM","trustevaluationagent","(none)\Verdasys’s Mac","Mac","","","","","","","","1BBB8272-F253-467A-8141-9F35910FDD9D","Verdasys’s Mac\_trustevaluationagent","","","","","","","Scanned","2/13/2015 6:26:34 PM","Virus Total: 0 / 55 scans positive.","","","","","UNKNOWN_HOST","","","","F19FC0CC-47C4-6545-8151-8BE641A93428","","","2c11f21a29e2f7f7346b2d62afa299af","1af2112c-e229-f7f7-346b-2d62afa299af","Inbound","File Copy","","0","","False","False","False","False","False","True","0","False","0","False","False","False","","","","","","","","","","","","","Not Blocked","0","50744","\private\var\folders\zz\zyxvpxvq6csfxvn_n00000t000006h\C\mds\","mdsDirectory.db_","","db_","F19FC0CD-47C4-6545-8151-8BE641A93428","50744","False","","","","","mdsDirectory.db","","\private\var\db\mds\system\","mdsDirectory.db","","db","","False","False","False","0","0","False","False","False","Fixed","","Fixed","","","","","","",""
      {
        split {
          inputField: message
          outputFields: [date_time,account_name,time_key,operator_key,equipment_key,action_key,event_id,event_detail_id,application,display_name,account_user_id,event_type,event_description,computer_name,domain_computer_name,source_drive_type,source_drive_description,source_directory,source_file,has_src_classification,dest_drive_type,dest_drive_description,destination_directory,destination_file,printer,printer_job_name,network_address,local_port,remote_port,DNS_hostname,email_sender,email_subject,email_recipient,email_recipient_domain,email_recipient_type,bytes_read,bytes_written,is_outbound,is_removable,was_blocked_event,was_blocked_event_detail,has_alert_event,has_alert_event_detail,detail_file_size_kb,row_insert_date,event_detail_row_insert_date,DWH_source,DWH_insert_date,DWH_update_date,original_event_date_time,source_file_type,destination_file_type,"","",""]
          separator: ","
          isRegex: false
          addEmptyStrings: true
          trim: true
        }
      }


      {
        EmptyObjectFilter {
          filterFields: [date_time, account_name, event_description]
        }
      }


      //Filter Non Mail types
      {
        if {
          conditions: [
            {not { equals {event_description:["Send Mail"]}}}
          ]
          then:[
            {LogFilterEvent {errorMessage: "Not Email event"}}
            {dropRecord {}}
          ]

        }
      }


      {
        findReplace {
          field: date_time
          pattern: "000000"
          isRegex: false
          replacement: ""
          replaceFirst: false
        }
      }


      {
        setValues {
          is_outbound:"false"
        }
      }


      {
        findReplace {
          field: is_removable
          pattern: "1"
          isRegex: false
          replacement: "true"
          replaceFirst: false
        }
      }
      {
        findReplace {
          field: is_removable
          pattern: "0"
          isRegex: false
          replacement: "false"
          replaceFirst: false
        }
      }

      {
        findReplace {
          field: has_src_classification
          pattern: "1"
          isRegex: false
          replacement: "true"
          replaceFirst: false
        }
      }
      {
        findReplace {
          field: has_src_classification
          pattern: "0"
          isRegex: false
          replacement: "false"
          replaceFirst: false
        }
      }

      {
        findReplace {
          field: was_blocked_event
          pattern: "1"
          isRegex: false
          replacement: "true"
          replaceFirst: false
        }
      }
      {
        findReplace {
          field: was_blocked_event
          pattern: "0"
          isRegex: false
          replacement: "false"
          replaceFirst: false
        }
      }

      {
        findReplace {
          field: was_blocked_event_detail
          pattern: "1"
          isRegex: false
          replacement: "true"
          replaceFirst: false
        }
      }
      {
        findReplace {
          field: was_blocked_event_detail
          pattern: "0"
          isRegex: false
          replacement: "false"
          replaceFirst: false
        }
      }

      {
        findReplace {
          field: has_alert_event
          pattern: "1"
          isRegex: false
          replacement: "true"
          replaceFirst: false
        }
      }
      {
        findReplace {
          field: has_alert_event
          pattern: "0"
          isRegex: false
          replacement: "false"
          replaceFirst: false
        }
      }

      {
        findReplace {
          field: has_alert_event_detail
          pattern: "1"
          isRegex: false
          replacement: "true"
          replaceFirst: false
        }
      }
      {
        findReplace {
          field: has_alert_event_detail
          pattern: "0"
          isRegex: false
          replacement: "false"
          replaceFirst: false
        }
      }

      {
        findReplace {
          field: detail_file_size_kb
          pattern: ""
          isRegex: false
          replacement: "0"
          replaceFirst: false
        }
      }

      //Is out bound logic on the mail recipent domain - for external domain the event will mark as outbound
      {
        if {
          conditions:[
            {not { equals {email_recipient_domain:["bankleumi.com"]}}}
          ]
          then:[
            {
              if {
                conditions: [
                  {not {equals {email_recipient_domain: [""]}}}
                ]
                then:
                  [
                    {
                      setValues {
                        is_outbound: "true"
                      }
                    }
                  ]
              }
            }
          ]
        }
      }

    ]

  }
]
