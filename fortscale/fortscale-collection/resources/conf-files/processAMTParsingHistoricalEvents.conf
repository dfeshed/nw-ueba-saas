morphlines : [
  {
    id : morphline1
    importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]
    commands : [



      # parse the raw message, extract all fields from the message, assuming the following format:
      # Mon Nov  3 00:05:55 2014,98.139.163.24,220.128.240.19,ip_angela1123,,STARTAMT,amtStart:Search Page,6ao697ha5ecol&b=3&s=60,,54573763
      {
        split {
          inputField : message
          outputFields : [logdate,target_ip,source_ip,username,yid,action_code,action_string,uri]
          separator : ","
        }
      }

      # Handle events with action codes of EMAILLOOKUP, MOBILELOOKUP and GUIDLOOKUP.
      # The comma char before 'yid =' is actually part of the original yid field and shouldn't be treated as a separator.
      # Sun Aug 10 17:16:17 2014,192.168.150.51,192.168.70.50,guerro18,Mobile = 1-4438663599, yid = statefun48,MOBILELOOKUP,Success,7jhdshh9ua1r7&b=4&d=mG.m.x1pYEJ.syjM.GkFlZGsgwi.gM3OKzzyhA--&s=7t&i=ou8lkeQLbEQ.WkpA7FeN,,53e80b51
      {
        if {
          conditions : [{contains  {action_string : [EMAILLOOKUP,MOBILELOOKUP,GUIDLOOKUP]}}]
          then : [
            # First, clean the original values out of the extracted fields.
            {
              setValues {
                logdate : []
                target_ip : []
                source_ip : []
                username : []
                yid : []
                action_code : []
                action_string : []
                uri : []
              }
            }

            {
              split {
                inputField : message
                outputFields : [logdate,target_ip,source_ip,username,lookup_value,yid,action_code,action_string,uri]
                separator : ","
              }
            }
          ]
        }
      }

      {
        addValues {
          timezone_output : "UTC"
        }
      }

      #align the date time format to be as the logic expected to get
      {
        convertTimestampFortscale {
          field : logdate
          inputFormats : ["EEE MMM  d HH:mm:ss yyyy","EEE MMM dd HH:mm:ss yyyy"]
          inputTimezoneField : "timezone_output"
          outputFormat : "yyyy-MM-dd'T'HH:mm:ss"
          outputTimezoneField : "timezone_output"
        }
      }


    ]
  }
]

