morphlines : [
	{
	    id : morphline1
	    importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]

    	commands : [
    	{
			tryRules {
		  		catchExceptions : true
		  		throwExceptionIfAllRulesFailed : false
		  		rules : [
				{
			  		commands : [
	  				{
						grok {
		  					dictionaryString : """
								ACCOUNT_NAME (?<=Account Name:[\s]{1,2})[\S ]+
							  	ACCOUNT_DOMAIN (?<=Account Domain:[\s]{1,2})[\S ]+
								SERVICE_NAME (?<=Service Name:[\s]{1,2})[\S ]+(?=\$)
								SERVICE_ID (?<=Service ID:[\s]{1,2})[\S ]+
								TICKET_OPTIONS (?<=Ticket Options:[\s]{1,2})[\S ]+
								FAILURE_CODE (?<=Failure Code:[\s]{1,2})[\S ]+
								SOURCE_NETWORK_ADDRESS (?<=Source Network Address:[\s]{1,2})[\S ]+
								TASK_CATEGORY (?<=TaskCategory=)[\S ]+(?=OpCode)
								LOG_NAME (?<=LogName=)[\S ]+(?=SourceName)
								RECORD_NUMBER (?<=RecordNumber=)[\S ]+(?=Keywords)
								SOURCE_NAME (?<=SourceName=)[\S ]+(?=EventCode)
								 """
		  					findSubstrings : true
						  	addEmptyStrings : true
						  	numRequiredMatches : all
						  	expressions : {
								messageData : "%{SOURCE_NAME:sourceName}|%{RECORD_NUMBER:recordNumber}|%{LOG_NAME:logfile}|%{TASK_CATEGORY:categoryString}|%{ACCOUNT_NAME:account_name}|%{ACCOUNT_DOMAIN:account_domain}|%{SERVICE_NAME:service_name}|%{SERVICE_ID:service_id}|%{TICKET_OPTIONS:ticket_options}|%{FAILURE_CODE:failure_code}|%{SOURCE_NETWORK_ADDRESS:source_network_address}"
						  	}
						}
      				}
			  		]
				}
		  	]
			}
		}
      	{
			GetHostnameFromDHCP {
		    	ipAddress : client_address
		        timeStamp: timeGeneratedUnixTime
		        outputRecordName : machine_name
		        host : "127.0.0.1"
		        port : 27017
		        db: "fortscale"
		        collection : "dhcp_log"
		        leaseTimeInMins : 2880
		        graceTimeInMins : 1
			}
      	}
	  	{
			if {
		  		conditions : [
		  			# if machine_name emtpy then
					{ equals  { machine_name : [""] } }
		  		]
		  		then : [
				{
					GetHostnameFromDNS {
						ip_address : client_address
						output_record_name : machine_name
			            short_name : true
						max_queries : 1000
					}
				}
				]
			}
	  	}
    	]
  	}
]
