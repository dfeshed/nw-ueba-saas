morphlines : [
	{
		id : morphline1
		importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]
		commands : [
			
			{
				split {
					inputField : message
					outputFields: [distinguishedName,isCriticalSystemObject,isDeleted,badPwdCount,logonCount,primaryGroupID,sAMAccountType,userAccountControl,accountExpires,badPasswordTime,lastLogoff,lockoutTime,assistant,memberOf,managedObjects,manager,masteredBy,directReports,secretary,logonHours,whenChanged,streetAddress,cn,company,c,department,description,displayName,division,mail,employeeID,employeeNumber,employeeType,givenName,l,o,personalTitle,otherFacsimileTelephoneNumber,otherHomePhone,homePhone,otherMobile,mobile,otherTelephone,roomNumber,userPrincipalName,telephoneNumber,title,userParameters,userWorkstations,lastLogon,pwdLastSet,whenCreated,sn,sAMAccountName,objectSid,objectGUID]
					separator : "|"
				}
			}
			{
				EmptyObjectFilter {
					filterFields: [sAMAccountName, userPrincipalName]
				}
			}
			{
				java {
					imports : "import java.util.*;import java.text.SimpleDateFormat;"
					code: """
						String[] fields = {"accountExpires","lastLogon","pwdLastSet","lockoutTime","badPasswordTime"};
						for (String field : fields) {
						Object fieldVal = record.getFirstValue(field);
						if ((fieldVal != null) && !(String.valueOf(fieldVal).equals(""))) {
							long fieldValLong =0;
							try{
								fieldValLong = Long.parseLong(String.valueOf(fieldVal).replace('"', ' ').trim());
							}
							catch(Exception x)
							{
								System.out.println("Exception: " + x.getMessage());
							}

							if (fieldValLong > 0) {
								long FILETIME_EPOCH_DIFF = 11644473600000L;
								long FILETIME_ONE_MILLISECOND = 10 * 1000;
								long dateInMillis = (fieldValLong / FILETIME_ONE_MILLISECOND) - FILETIME_EPOCH_DIFF;
								TimeZone UTCTimeZone = TimeZone.getTimeZone("UTC");
								Calendar cal =Calendar.getInstance(UTCTimeZone);
								cal.setTimeInMillis(dateInMillis);
								SimpleDateFormat sdf = new SimpleDateFormat("yyyy/MM/dd'T'HH:mm:ss");
								sdf.setTimeZone(UTCTimeZone);
								record.replaceValues(field,sdf.format(cal.getTime()));
							}
						}
						}
						return child.process(record);
						"""
				}
			}
			{
				if {
					conditions : [
						# if accountExpires = 0 then put the date 30828/09/13T19:48:05
						{ equals  { accountExpires : ["0"] } }
					]
					then : [
						{
							setValues {
								accountExpires : ["30828/09/13T19:48:05"]
							}
						}
					]
				}
			}	  
			{
				tryRules {
					catchExceptions : true
					throwExceptionIfAllRulesFailed : false
					rules : [
						{
						commands : [
							{
								convertTimestampFortscale {
									field : whenChanged
									#20130613123848.0Z
									outputFormat : "yyyy/MM/dd'T'HH:mm:ss"
								}
							}
						]
						}
						{
							commands : [
								{ logWarn { format : "Problem whenChanged: {}", args : ["@{whenChanged}"] } }
							]
						}
					]
				}
			}
			
			{
				tryRules {
					catchExceptions : true
					throwExceptionIfAllRulesFailed : false
					rules : [
						{
						commands : [
							{
								convertTimestampFortscale {
									field : whenCreated
									#20130613123848.0Z
									outputFormat : "yyyy/MM/dd'T'HH:mm:ss"
								}
							}
						]
					}
					
					{
						commands : [
							{ logWarn { format : "Problem whenCreated: {}", args : ["@{whenCreated}"] } }
						]
					}
					]
				}
			}
		]
	}
]
