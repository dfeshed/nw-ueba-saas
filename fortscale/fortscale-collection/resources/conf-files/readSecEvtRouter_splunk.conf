morphlines : [
{
	id : morphline1
	importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]

    commands : [
		{
	  		split {
	  			inputField : message
				outputFields : [timeGenerated,messageData]
				separator : "|"
	  		}
	  	}
	  	{
			tryRules {
		  		catchExceptions : true
		  		throwExceptionIfAllRulesFailed : false
		  		rules : [
				{
			  		commands : [
	  				{
						grok {
		  					dictionaryString : """
		  						EVENT_CODE (?<=EventCode\=)[0-9]+
		  						ACCOUNT_NAME (?<=Account Name:).+?(?=Supplied Realm Name)|(?<=Account Name:).+?(?=Account Domain)|(?<=Account Name:).+?(?=Service Information)
								 """
		  					findSubstrings : true
						  	addEmptyStrings : true
						  	numRequiredMatches : all
						  	expressions : {
								messageData : "%{ACCOUNT_NAME:account_name}|%{EVENT_CODE:eventCode}"
						  	}
						}
      				}
      				{ toString { field : account_name, trim : true } }
			  		]
				}
		  	]
			}
		}
		{ 
			if { 
				conditions : [ 
					{ equals { account_name : [] } } 
				] 
				then : [
					{ logWarn { format : "Record does not contain account_name field, Drop the record. Original message was: {}", args : ["@{message}"] } }
					{ dropRecord {} }
				] 
			} 
		}
		
		{
			if {
				conditions : [
					{ equals { eventCode : [] } }
				]
				then : [
					{ logError { format : "Record does not contain EventCode field, Drop the record. Original message was: {}", args : ["@{message}"] } }
					{ dropRecord {} }
				]
			}
		}
				
		# Adding isComputer.
		{
			java {
				imports : "import java.util.*;"
				code:
					"""
					String account_name = (String)record.getFirstValue("account_name");
					Boolean isComputer = account_name.contains("$") ? true : false;
					record.replaceValues("isComputer", isComputer);
					return child.process(record);
					"""
			}
		}
	]
  }
]
