morphlines: [
  {
    id: Parsing_SecurityEvents
    importCommands: ["org.kitesdk.morphline.**", "org.apache.solr.**", "fortscale.collection.morphlines.**"]
    commands: [
      {
        split {
          inputField: message
          outputFields: ["", "", "", "", eventCode, "", date_time]
          separator: "||"
        }
      }
      {
        addValues {
          messageData: "@{message}"
        }
      }
      {
        if {
          conditions: [
            {not {equals {eventCode: ["4624"]}}}
          ]
          then: [
            {
              if {
                conditions: [
                  {equals {eventCode: ["4768"]}}
                ]
                then: [
                  {
                    split {
                      inputField: messageData
                      outputFields: ["", "", "", "", "", "", "", "", reporting_server, "", "", "", account_name, "", "", "", "", ticket_options, "", "", "", client_address]
                      separator: "||"
                    }
                  }
                ]
                else: [
                  {
                    split {
                      inputField: messageData
                      outputFields: ["", "", "", "", "", "", "", "", reporting_server, "", "", "", account_name, "", "", "", ticket_options, "", client_address]
                      separator: "||"
                    }
                  }
                ]
              }
            }
            {
              addValues {
                timezone: "UTC"
              }
            }
            {toString {field: client_address, trim: true}}
            {toString {field: ticket_options, trim: true}}
            {toString {field: account_name, trim: true}}
            {toString {field: reporting_server, trim: true}}
            {toString {field: timezone, trim: true}}
            {
              EmptyObjectFilter {
                filterFields: [eventCode, account_name, client_address, ticket_options]
              }
            }
            {
              OverFlowFilter {
                eventsType: securityEvents
                criteria: [eventCode, account_name]
                threshold: 100000
              }
            }
            {
              OverFlowFilter {
                eventsType: securityEvents
                criteria: [eventCode]
                threshold: 2000000
              }
            }
            {
              if {
                conditions: [
                  {equals {timezone: []}}
                ]
                then: [
                  {
                    GetTimezone {
                      sourceType: "sec"
                      hostnameField: reporting_server
                      timezoneOutputField: timezone_input
                    }
                  }
                ]
                else: [
                  {
                    addValues {
                      timezone_input: "@{timezone}"
                    }
                  }
                ]
              }
            }
            {
              findReplace {
                field: account_name
                isRegex: false
                pattern: "'"
                replacement: ""
              }
            }
            {
              addValues {
                timeGeneratedRaw: "@{date_time}"
                date_time_unix: "@{date_time}"
              }
            }
            {
              java {
                imports: "import java.util.*;"
                code:
                  """
							String account_name = (String)record.getFirstValue("account_name");
							Boolean isComputer = account_name.contains("$") ? true : false;
							record.replaceValues("isComputer", isComputer);
							return child.process(record);
							"""
              }
            }
            {
              tryRules {
                catchExceptions: true
                throwExceptionIfAllRulesFailed: false
                rules: [
                  {
                    commands: [
                      {
                        convertTimestampFortscale {
                          field: date_time
                          inputFormats: ["unixTimeInSeconds"]
                          inputTimezoneField: timezone_input
                          outputFormat: "yyyy-MM-dd HH:mm:ss"
                        }
                      }
                    ]
                  }
                ]
              }
            }
            {
              tryRules {
                catchExceptions: true
                throwExceptionIfAllRulesFailed: false
                rules: [
                  {
                    commands: [
                      {
                        findReplace {
                          field: client_address
                          pattern: "::1"
                          isRegex: false
                          replacement: "127.0.0.1"
                          replaceFirst: false
                        }
                      }
                      {
                        findReplace {
                          field: client_address
                          pattern: "::ffff:"
                          isRegex: false
                          replacement: ""
                          replaceFirst: false
                        }
                      }
                    ]
                  }
                ]
              }
            }
            {
              addValues {
                is_nat: false
              }
            }
          ]
        }
      }
    ]
  }
]