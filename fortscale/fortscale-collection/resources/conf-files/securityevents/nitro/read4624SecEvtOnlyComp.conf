morphlines : [
	{
		id : sec4624
		importCommands : ["org.kitesdk.morphline.**", "org.apache.solr.**","fortscale.collection.morphlines.**"]
		commands : [
			{
				split {
					inputField: messageData
					#144117387552096256,121168999,ELM,1441065972,,,10.8.48.101||Security||<BookmarkList>%0D   <Bookmark Channel='Security' RecordId='203987342' IsCurrent='true'/>%0D </BookmarkList>||Microsoft-Windows-Security-Auditing||4624||262||1441065303||0||SNCH2DCS01.bla-net.ads||||||20||S-1-0-0||-||-||0x0||S-1-5-21-1324571244-530250876-991709287-36673||SNCH2DCS02V$||BLA-NET||0xe125cb2d||3||Kerberos||Kerberos||||57041bc9-c5e5-a4ad-c7f7-303659159b50||-||-||0||0x0||-||10.8.48.102||65215||An account was successfully logged on.%0D %0D Subject:%0D %09Security ID:%09%09%251%0D %09Account Name:%09%09%252%0D %09Account Domain:%09%09%253%0D %09Logon ID:%09%09%254%0D %0D Logon Type:%09%09%09%259%0D %0D New Logon:%0D %09Security ID:%09%09%255%0D %09Account Name:%09%09%256%0D %09Account Domain:%09%09%257%0D %09Logon ID:%09%09%258%0D %09Logon GUID:%09%09%2513%0D %0D Process Information:%0D %09Process ID:%09%09%2517%0D %09Process Name:%09%09%2518%0D %0D Network Information:%0D %09Workstation Name:%09%2512%0D %09Source Network Address:%09%2519%0D %09Source Port:%09%09%2520%0D %0D Detailed Authentication Information:%0D %09Logon Process:%09%09%2510%0D %09Authentication Package:%09%2511%0D %09Transited Services:%09%2514%0D %09Package Name (NTLM only):%09%2515%0D %09Key Length:%09%09%2516%0D %0D This event is generated when a logon session is created. It is generated on the computer that was accessed.%0D %0D The subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.%0D %0D The logon type field indicates the kind of logon that occurred. The most common types are 2 (interactive) and 3 (network).%0D %0D The New Logon fields indicate the account for whom the new logon was created, i.e. the account that was logged on.%0D %0D The network fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.%0D %0D The authentication information fields provide detailed information about this specific logon request.%0D %09- Logon GUID is a unique identifier that can be used to correlate this event with a KDC event.%0D %09- Transited services indicate which intermediate services have participated in this logon request.%0D %09- Package name indicates which sub-protocol was used among the NTLM protocols.%0D %09- Key length indicates the length of the generated session key. This will be 0 if no session key was requested.
					outputFields: ["", "", "", "", "", "", "", "", reporting_server, "", "", "", "", account_name, account_domain, "", "", account_name2, account_domain2, "", "", "", "", "", "", "", "", "", "", "", source_ip]
					separator: "||"
				}
			}
			{
				if {
					conditions: [
						{equals {account_domain: ["-"]}}
					]
					then: [
						{
							setValues {
								account_name : "@{account_name2}"
								account_domain : "@{account_domain2}"
							}
						}
					]
				}
			}
			{
				addValues {
					#MISSING
					timezone: "UTC",
					logon_process: "Kerberos"
				}
			}
			{ toString { field : account_name, trim : true } }
			{ toString { field : source_ip, trim : true } }
			{ toString { field : logon_process, trim : true } }
			{ toString { field : account_domain, trim : true } }
			{ toString { field : reporting_server, trim : true } }
			{ toString { field : timezone, trim : true } }
			{
				EmptyObjectFilter {
					filterFields : [account_name,source_ip,logon_process,reporting_server]
				}
			}
			{
				if {
					conditions : [
						{ not { equals { logon_process : [Kerberos] } } }
					]
					then : [
						{LogFilterEvent { errorMessage: "Non Kerberos Event"}}
						{ dropRecord {} }
					]
				}
			}
			{
				if {
					conditions : [
						{ equals { source_ip : ["::1"] } }
					]
					then : [
					    {LogFilterEvent { errorMessage: "Local IPv6 Address"}}
						{ dropRecord {} }
					]
				}
			}
			{
				if {
					conditions : [
						{ equals { source_ip : ["127.0.0.1"] } }
					]
					then : [
					    {LogFilterEvent { errorMessage: "Local IPv4 Address"}}
						{ dropRecord {} }
					]
				}
			}
			{
				java {
					imports : "import java.util.*;"
					code:
						"""
            String account_name = (String)record.get("account_name").get(0);
            record.replaceValues("account_name", account_name);
            String account_domain = (String)record.get("account_domain").get(0);
            record.replaceValues("account_domain", account_domain);
            return child.process(record);
            """
				}
			}
			{
				FilterOUMachine {
					hostnameField : account_name
					regex : "(.+)\\$$# #$1"
				}
			}
			{
				if {
					conditions : [
						{ equals { timezone : [] }}
					]
					then : [
						{
							GetTimezone {
								sourceType : "sec"
								hostnameField : reporting_server
								timezoneOutputField : timezone_input
							}
						}
					]
					else : [
						{
							addValues {
								timezone_input : "@{timezone}"
							}
						}
					]
				}
			}
			{
				addValues {
					date_time_unix : "@{date_time}"
				}
			}
			{
				ComputerLoginUpdate {
					timestampepoch_field : date_time_unix
					ipaddress_field: source_ip
					hostname_field : account_name
					domain_field : account_domain
					max_batch_size : 10000
				}
			}
			{
				addValues {
					isADHostName : true
				}
			}
		]
	}]