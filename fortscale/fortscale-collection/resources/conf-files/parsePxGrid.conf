# Morphline file that parse ISE events into canonical format
#Example:
# Mon Dec 14 14:30:12 IST 2015,192.168.0.81,zehavitv
morphlines: [
  {
    id: parsePxGrid
    importCommands: ["org.kitesdk.morphline.**", "org.apache.solr.**", "fortscale.collection.morphlines.**"]

    commands: [
      {
        split {
          inputField: message
          outputFields: [createdAt, ipaddress, hostname]
          separator: ","
        }
      }

      # drop events with missing ip or hostname
      {
        EmptyObjectFilter {
          filterFields: [createdAt, ipaddress, hostname]
        }
      }

      {
        addValues {
          timestampepoch: "@{createdAt}"
        }
      }

      # convert event time to utc timestamp
      {
        convertTimestampFortscale {
          field: timestampepoch
          inputFormats: ["EEE MMM d HH:mm:ss z yyyy"]
          outputFormat: "unixTimeInSeconds"

        }
      }

      # check if the hostname is in AD
      {
        IsADComputer {
          hostnameField: "hostname"
          outputField: "adHostName"
        }
      }
    ]
  }
]
