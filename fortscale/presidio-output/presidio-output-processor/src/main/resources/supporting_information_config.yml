indicators:

#*********************************************************
#*                   FILE INDICATORS                     *
#*********************************************************

- id: highestStartInstantScoreUserIdFileHourly
  type: SCORE_AGGREGATION
  name: abnormal_event_day_time
  adeEventType: scored_enriched.file.startInstant.userId.file.score
  schema: FILE
  anomalyDescriptior:
    anomalyField: eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdFileDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestOperationTypeScoresUserIdFilePermissionChangeFileHourly
  type: SCORE_AGGREGATION
  name: abnormal_file_permision_change_operation_type
  adeEventType: scored_enriched.file.operationType.userIdFilePermissionChange.file.score
  schema: FILE
  anomalyDescriptior:
    anomalyField: operationType
    anomalyFilters:
      fieldName: operationTypeCategories
      fieldValue: FILE_PERMISSION_CHANGE
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdFileDaily
    featureName: operationTypeHistogram
  classification: mass_permission_changes

- id: sumOfHighestOperationTypeScoresUserIdFileActionFileHourly
  type: SCORE_AGGREGATION
  name: abnormal_file_action_operation_type
  schema: FILE
  adeEventType: scored_enriched.file.operationType.userIdFileAction.file.score
  anomalyDescriptior:
    anomalyField: operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdFileDaily
    featureName: operationTypeHistogram
  classification: abnormal_file_access

- id: numberOfSuccessfulFilePermissionChangesUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_file_permission_change
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_PERMISSION_CHANGE
    anomalyFilters:
      fieldName: result
      fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: mass_permission_changes

- id: numberOfSuccessfulFileActionsUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_file_action_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_ACTION
    anomalyFilters:
      fieldName: result
      fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: snooping_user

- id: numberOfFailedFilePermissionChangesUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_file_permission_change_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_PERMISSION_CHANGE
    anomalyFilters:
      fieldName: result
      fieldValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: mass_permission_changes

- id: numberOfFailedFileActionsUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_file_action_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_ACTION
    anomalyFilters:
      fieldName: result
      fieldValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: snooping_user

- id: numberOfDistinctFileOpenedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_files_opened_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_OPENED
  historicalData:
    type: hourly_aggregations
  classification: snooping_user


- id: numberOfDistinctFolderOpenedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_folders_opened_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FOLDER_OPENED
  historicalData:
    type: hourly_aggregations
  classification: snooping_user


- id: numberOfFileDeletedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_deletions
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_DELETED
  historicalData:
    type: hourly_aggregations
  classification: abnormal_file_access

- id: numberOfSuccessfulFileRenamedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_file_rename_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_RENAMED
    anomalyFilters:
      fieldName: result
      fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: mass_file_rename

- id: numberOfFileMovedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_move_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_MOVED
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFileMovedFromSharedDriveUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_move_operations_from_shared_drive
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_MOVED
    anomalyFilters:
      fieldName: isSrcDriveShared
      fieldValue: true
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFileMovedToSharedDriveUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_move_operations_to_shared_drive
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_MOVED
    anomalyFilters:
      fieldName: isDstDriveShared
      fieldValue: true
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration


#*********************************************************
#*              ACTIVE DIRECTORY INDICATORS              *
#*********************************************************

- id: highestStartInstantScoreUserIdActiveDirectoryHourly
  type: SCORE_AGGREGATION
  name: abnormal_active_directory_day_time_operation
  adeEventType: scored_enriched.active_directory.startInstant.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdActiveDirectoryDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestOperationTypeScoresUserIdGroupMembershipSecuritySensitiveActiveDirectoryHourly
  type: SCORE_AGGREGATION
  name: abnormal_group_membership_sensitive_operation
  adeEventType: scored_enriched.active_directory.operationType.userIdGroupMembershipSecuritySensitive.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: abnormal_ad_changes

- id: sumOfHighestOperationTypeScoresUserIdObjectChangeActiveDirectoryHourly
  type: SCORE_AGGREGATION
  name: abnormal_object_change_operation
  adeEventType: scored_enriched.active_directory.operationType.userIdObjectChange.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: abnormal_ad_changes

- id: numberOfSensitiveGroupMembershipOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_senesitive_group_membership_events
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: SECURITY_SENSITIVE_OPERATION
    anomalyFilters:
        fieldName: operationTypeCategories
        fieldValue: GROUP_MEMBERSHIP
  historicalData:
    type: hourly_aggregations
  classification: mass_changes_to_critical_enterprise_groups

- id: numberOfGroupMembershipOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_group_membership_events
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: GROUP_MEMBERSHIP
  historicalData:
    type: hourly_aggregations
  classification: mass_changes_to_groups

- id: numberOfSuccessfulObjectChangeOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_object_change_operations
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: abnormal_ad_changes


- id: numberOfSuccessfulSecuritySensitiveOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_security_sensitive_operations
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: SECURITY_SENSITIVE_OPERATION
    anomalyFilters:
      fieldName: result
      fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: abnormal_ad_changes

- id: numberOfFailedOperationTypeUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_active_directory_events
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: abnormal_ad_changes

- id: adminPasswordChangedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: admin_changed_his_own_password
  adeEventType: scored_enriched.active_directory.adminPasswordChanged.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: USER_PASSWORD_CHANGED
    anomalyFilters:
        fieldName: isUserAdmin
        fieldValue: true
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: admin_password_change

- id: nonAdminPasswordChangedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_password_changed
  adeEventType: scored_enriched.active_directory.nonAdminPasswordChanged.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: USER_PASSWORD_CHANGED
    anomalyFilters:
      fieldName: isUserAdmin
      fieldValue: false
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountEnabledScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_enabled
  adeEventType: scored_enriched.active_directory.userAccountEnabled.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_ENABLED
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes


- id: userAccountDisabledScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_disabled
  adeEventType: scored_enriched.active_directory.userAccountDisabled.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_DISABLED
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountUnlockedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_unlocked
  adeEventType: scored_enriched.active_directory.userAccountUnlocked.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: USER_ACCOUNT_UNLOCKED
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountTypeChangedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_type_changed
  adeEventType: scored_enriched.active_directory.userAccountTypeChanged.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_TYPE_CHANGED
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountLockedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_locked
  adeEventType: scored_enriched.active_directory.userAccountLocked.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_LOCKED
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userPasswordNeverExpiresOptionChangedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_password_never_expires_option_changed
  adeEventType: scored_enriched.active_directory.userPasswordNeverExpiresOptionChanged.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_PASSWORD_NEVER_EXPIRES_OPTION_CHANGED
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: passwordChangedByNonOwnerScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_password_changed_by_non-owner
  adeEventType: scored_enriched.active_directory.passwordChangedByNonOwner.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_PASSWORD_CHANGED_BY_NON_OWNER
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: nestedMemberAddedToCriticalEnterpriseGroupScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: nested_member_added_to_critical_enterprise_group
  adeEventType: scored_enriched.active_directory.nestedMemberAddedToCriticalGroup.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: NESTED_MEMBER_ADDED_TO_CRITICAL_ENTERPRISE_GROUP
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: elevated_privileges_granted

- id: memberAddedToCriticalEnterpriseGroupScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: member_added_to_critical_enterprise_group
  adeEventType: scored_enriched.active_directory.memberAddedToCriticalGroup.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: MEMBER_ADDED_TO_CRITICAL_ENTERPRISE_GROUP
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: elevated_privileges_granted


#*********************************************************
#*                AUTHENTICATION INDICATORS              *
#*********************************************************

- id: highestStartInstantScoreUserIdAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_logon_day_time
  adeEventType: scored_enriched.authentication.startInstant.userId.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdAuthenticationDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestSrcMachineNameRegexClusterScoresUserIdAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_source_machine
  adeEventType: scored_enriched.authentication.srcMachine.userId.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: srcMachineNameRegexCluster
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcMachineNameRegexClusterHistogramUserIdAuthenticationDaily
    featureName: srcMachineNameRegexClusterHistogram
  classification: user_login_to_abnormal_host

- id: sumOfHighestDstMachineNameRegexClusterScoresUserIdInteractiveRemoteAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_remote_destination_machine
  adeEventType: scored_enriched.authentication.dstMachine.userIdInteractiveRemote.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineNameRegexCluster
    anomalyFilters:
      fieldName: operationTypeCategories
      fieldValue: INTERACTIVE_REMOTE
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstMachineNameRegexClusterHistogramUserIdInteractiveRemoteAuthenticationDaily
    featureName: dstMachineNameRegexClusterHistogram
  classification: user_login_to_abnormal_remote_host

- id: numberOfSuccessfulAuthenticationsUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_authentications
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: multiple_logons_by_user

- id: numberOfFailedAuthenticationsUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_authentications
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: multiple_failed_logons

- id: numberOfDistinctDstMachineDomainUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_destination_domains
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineDomain
  historicalData:
    type: hourly_aggregations
  classification: user_logins_to_multiple_domains

- id: numberOfDistinctSrcMachineIdUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_src_computers
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: srcMachineId
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctDstMachineIdUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_dst_computers
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineId
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctSrcMachineNameRegexClusterUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_src_computer_clusters
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: srcMachineNameRegexCluster
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctDstMachineNameRegexClusterUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_dst_computer_clusters
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineNameRegexCluster
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

classificationPriority:

- classificationName: mass_changes_to_critical_enterprise_groups
  priority: 1

- classificationName: mass_changes_to_groups
  priority: 2

- classificationName: elevated_privileges_granted
  priority: 3

- classificationName: multiple_failed_logons
  priority: 4

- classificationName: user_logins_to_multiple_domains
  priority: 5

- classificationName: user_login_to_abnormal_remote_host
  priority: 6

- classificationName: user_login_to_abnormal_host
  priority: 7

- classificationName: data_exfiltration
  priority: 8

- classificationName: mass_file_rename
  priority: 9

- classificationName: snooping_user
  priority: 10

- classificationName: multiple_logons_by_user
  priority: 11

- classificationName: user_logged_into_multiple_hosts
  priority: 12

- classificationName: admin_password_change
  priority: 13

- classificationName: mass_permission_changes
  priority: 14

- classificationName: abnormal_ad_changes
  priority: 15

- classificationName: sensitive_user_status_changes
  priority: 16

- classificationName: abnormal_file_access
  priority: 17

- classificationName: non_standard_hours
  priority: 18

- classificationName: suspicious_user_activity
  priority: 19
