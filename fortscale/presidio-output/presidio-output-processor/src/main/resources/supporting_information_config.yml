indicators:

#*********************************************************
#*                   FILE INDICATORS                     *
#*********************************************************

- id: highestStartInstantScoreUserIdFileHourly
  type: SCORE_AGGREGATION
  name: abnormal_file_day_time
  adeEventType: scored_enriched.file.startInstant.userId.file.score
  schema: FILE
  anomalyDescriptior:
    anomalyField: eventDate
  splitFields:
    - eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdFileDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestOperationTypeScoresUserIdFilePermissionChangeFileHourly
  type: SCORE_AGGREGATION
  name: abnormal_file_permision_change_operation_type
  adeEventType: scored_enriched.file.operationType.userIdFilePermissionChange.file.score
  schema: FILE
  anomalyDescriptior:
    anomalyField: operationType
    anomalyFilters:
      - fieldName: operationTypeCategories
        fieldValue: FILE_PERMISSION_CHANGE
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdFileDaily
    featureName: operationTypeHistogram
  classification: mass_permission_changes

- id: sumOfHighestOperationTypeScoresUserIdFileActionFileHourly
  type: SCORE_AGGREGATION
  name: abnormal_file_action_operation_type
  schema: FILE
  adeEventType: scored_enriched.file.operationType.userIdFileAction.file.score
  anomalyDescriptior:
    anomalyField: operationType
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdFileDaily
    featureName: operationTypeHistogram
  classification: abnormal_file_access

- id: numberOfSuccessfulFilePermissionChangesUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_file_permission_change
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_PERMISSION_CHANGE
    anomalyFilters:
      - fieldName: result
        fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: mass_permission_changes

- id: numberOfSuccessfulFileActionsUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_file_action_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_ACTION
    anomalyFilters:
      - fieldName: result
        fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: snooping_user

- id: numberOfFailedFilePermissionChangesUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_file_permission_change_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_PERMISSION_CHANGE
    anomalyFilters:
      - fieldName: result
        fieldValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: mass_permission_changes

- id: numberOfFailedFileActionsUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_file_action_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: FILE_ACTION
    anomalyFilters:
      - fieldName: result
        fieldValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: snooping_user

- id: numberOfDistinctFileOpenedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_files_opened_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_OPENED
  historicalData:
    type: hourly_aggregations
  classification: snooping_user


- id: numberOfDistinctFolderOpenedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_folders_opened_attempts
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FOLDER_OPENED
  historicalData:
    type: hourly_aggregations
  classification: snooping_user


- id: numberOfFileDeletedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_deletions
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_DELETED
  historicalData:
    type: hourly_aggregations
  classification: abnormal_file_access

- id: numberOfSuccessfulFileRenamedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_file_rename_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_RENAMED
    anomalyFilters:
      - fieldName: result
        fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: mass_file_rename

- id: numberOfFileMovedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_move_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_MOVED
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFileMovedFromSharedDriveUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_move_operations_from_shared_drive
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_MOVED
    anomalyFilters:
      - fieldName: isSrcDriveShared
        fieldValue: true
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFileMovedToSharedDriveUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_move_operations_to_shared_drive
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_MOVED
    anomalyFilters:
      - fieldName: isDstDriveShared
        fieldValue: true
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFileDownloadedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_downloaded_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_DOWNLOADED
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFileCopiedUserIdFileHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_file_copied_operations
  schema: FILE
  adeEventType: file
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: FILE_COPIED
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

#*********************************************************
#*              ACTIVE DIRECTORY INDICATORS              *
#*********************************************************

- id: highestStartInstantScoreUserIdActiveDirectoryHourly
  type: SCORE_AGGREGATION
  name: abnormal_active_directory_day_time_operation
  adeEventType: scored_enriched.active_directory.startInstant.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: eventDate
  splitFields:
    - eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdActiveDirectoryDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestOperationTypeScoresUserIdGroupMembershipSecuritySensitiveActiveDirectoryHourly
  type: SCORE_AGGREGATION
  name: abnormal_group_membership_sensitive_operation
  adeEventType: scored_enriched.active_directory.operationType.userIdGroupMembershipSecuritySensitive.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
    anomalyFilters:
      - fieldName: operationTypeCategories
        fieldValue: GROUP_MEMBERSHIP_OPERATION,SECURITY_SENSITIVE_OPERATION
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: abnormal_ad_changes

- id: sumOfHighestOperationTypeScoresUserIdObjectManagementActiveDirectoryHourly
  type: SCORE_AGGREGATION
  name: abnormal_object_change_operation
  adeEventType: scored_enriched.active_directory.operationType.userIdObjectManagement.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
    anomalyFilters:
      - fieldName: operationTypeCategories
        fieldValue: OBJECT_MANAGEMENT
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdObjectManagementActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: abnormal_ad_changes

- id: numberOfSensitiveGroupMembershipOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_senesitive_group_membership_events
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: GROUP_MEMBERSHIP_OPERATION,SECURITY_SENSITIVE_OPERATION
  historicalData:
    type: hourly_aggregations
  classification: mass_changes_to_critical_enterprise_groups

- id: numberOfGroupMembershipOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_group_membership_events
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: GROUP_MEMBERSHIP_OPERATION
  historicalData:
    type: hourly_aggregations
  classification: mass_changes_to_groups

- id: numberOfSuccessfulObjectManagementOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_object_change_operations
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: OBJECT_MANAGEMENT
    anomalyFilters:
       - fieldName: result
         fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: abnormal_ad_changes


- id: numberOfSuccessfulUserManagementSecuritySensitiveOperationUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_user_change_security_sensitive_operations
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationTypeCategories
    anomalyValue: USER_MANAGEMENT,SECURITY_SENSITIVE_OPERATION
    anomalyFilters:
      - fieldName: result
        fieldValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: abnormal_ad_changes

- id: numberOfFailedOperationTypeUserIdActiveDirectoryHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_active_directory_events
  adeEventType: active_directory
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: abnormal_ad_changes

- id: userAccountEnabledScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_enabled
  adeEventType: scored_enriched.active_directory.userAccountEnabled.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_ENABLED
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes


- id: userAccountDisabledScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_disabled
  adeEventType: scored_enriched.active_directory.userAccountDisabled.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_DISABLED
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountUnlockedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_unlocked
  adeEventType: scored_enriched.active_directory.userAccountUnlocked.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
    anomalyField: operationType
    anomalyValue: USER_ACCOUNT_UNLOCKED
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountTypeChangedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_type_changed
  adeEventType: scored_enriched.active_directory.userAccountTypeChanged.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_TYPE_CHANGED
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userAccountLockedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_account_locked
  adeEventType: scored_enriched.active_directory.userAccountLocked.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_ACCOUNT_LOCKED
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userPasswordNeverExpiresOptionChangedScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_password_never_expires_option_changed
  adeEventType: scored_enriched.active_directory.userPasswordNeverExpiresOptionChanged.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_PASSWORD_NEVER_EXPIRES_OPTION_CHANGED
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes

- id: userPasswordResetScoreUserIdActiveDirectoryHourly
  type: STATIC_INDICATOR
  name: user_password_reset
  adeEventType: scored_enriched.active_directory.userPasswordReset.userId.activeDirectory.score
  schema: ACTIVE_DIRECTORY
  anomalyDescriptior:
      anomalyField: operationType
      anomalyValue: USER_PASSWORD_RESET
  splitFields:
    - operationType
  historicalData:
    type: count_aggregations
    featureBucketConfName: operationTypeHistogramUserIdSecuritySensitiveActiveDirectoryDaily
    featureName: operationTypeHistogram
  classification: sensitive_user_status_changes


#*********************************************************
#*                AUTHENTICATION INDICATORS              *
#*********************************************************

- id: highestStartInstantScoreUserIdAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_logon_day_time
  adeEventType: scored_enriched.authentication.startInstant.userId.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: eventDate
  splitFields:
    - eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdAuthenticationDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestSrcMachineNameRegexClusterScoresUserIdAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_source_machine
  adeEventType: scored_enriched.authentication.srcMachine.userId.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: srcMachineNameRegexCluster
  splitFields:
    - srcMachineNameRegexCluster
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcMachineNameRegexClusterHistogramUserIdAuthenticationDaily
    featureName: srcMachineNameRegexClusterHistogram
  classification: user_login_to_abnormal_host
  transformer: abnormalSourceMachineTransformer

- id: sumOfHighestDstMachineNameRegexClusterScoresUserIdAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_destination_machine
  adeEventType: scored_enriched.authentication.dstMachine.userId.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineNameRegexCluster
  splitFields:
    - dstMachineNameRegexCluster
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstMachineNameRegexClusterHistogramUserIdAuthenticationDaily
    featureName: dstMachineNameRegexClusterHistogram
  classification: user_login_to_abnormal_remote_host

- id: sumOfHighestSiteScoresUserIdAuthenticationHourly
  type: SCORE_AGGREGATION
  name: abnormal_site
  adeEventType: scored_enriched.authentication.site.userId.authentication.score
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: site
  splitFields:
    - site
  historicalData:
      type: count_aggregations
      featureBucketConfName: siteHistogramUserIdAuthenticationDaily
      featureName: siteHistogram
  classification: abnormal_site_access

- id: numberOfSuccessfulAuthenticationsUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_authentications
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: multiple_logons_by_user

- id: numberOfFailedAuthenticationsUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_authentications
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: brute_force_authentication

- id: numberOfDistinctDstMachineDomainUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_destination_domains
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineDomain
  historicalData:
    type: hourly_aggregations
  classification: user_logins_to_multiple_domains

- id: numberOfDistinctSrcMachineIdUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_src_computers
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: srcMachineId
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctDstMachineIdUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_dst_computers
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineId
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctSrcMachineNameRegexClusterUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_src_computer_clusters
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: srcMachineNameRegexCluster
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctDstMachineNameRegexClusterUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_dst_computer_clusters
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: dstMachineNameRegexCluster
  historicalData:
    type: hourly_aggregations
  classification: user_logged_into_multiple_hosts

- id: numberOfDistinctSiteUserIdAuthenticationHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_sites
  adeEventType: authentication
  schema: AUTHENTICATION
  anomalyDescriptior:
    anomalyField: site
  historicalData:
    type: hourly_aggregations
  classification: abnormal_site_access

#*********************************************************
#*                PRINT INDICATORS              *
#*********************************************************

- id: highestStartInstantScoreUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_print_time
  adeEventType: scored_enriched.print.startInstant.userId.print.score
  schema: PRINT
  anomalyDescriptior:
    anomalyField: eventDate
  splitFields:
    - eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdPrintDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestSrcMachineNameRegexClusterScoresUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_source_machine_cluster_print
  adeEventType: scored_enriched.print.srcMachineNameRegexCluster.userId.print.score
  schema: PRINT
  anomalyDescriptior:
    anomalyField: srcMachineCluster
  splitFields:
    - srcMachineCluster
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcMachineNameRegexClusterHistogramUserIdPrintDaily
    featureName: srcMachineNameRegexClusterHistogram
  classification: print_from_abnormal_host

- id: sumOfHighestDstMachineIdScoresUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_destination_machine_print
  adeEventType: scored_enriched.print.dstMachineId.userId.print.score
  schema: PRINT
  anomalyDescriptior:
    anomalyField: printerId
  splitFields:
    - printerId
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstMachineIdHistogramUserIdPrintDaily
    featureName: dstMachineIdHistogram
  classification: print_to_abnormal_printer

- id: sumOfHighestDstMachineNameRegexClusterScoresUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_destination_machine_cluster_print
  adeEventType: scored_enriched.print.dstMachineNameRegexCluster.userId.print.score
  schema: PRINT
  anomalyDescriptior:
    anomalyField: printerCluster
  splitFields:
    - printerCluster
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstMachineNameRegexClusterHistogramUserIdPrintDaily
    featureName: dstMachineNameRegexClusterHistogram
  classification: print_to_abnormal_printer

- id: sumOfHighestAbsoluteSharedFolderPathScoresUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_shared_folder_path_print
  schema: PRINT
  adeEventType: scored_enriched.print.absoluteSharedFolderPath.userId.print.score
  anomalyDescriptior:
    anomalyField: srcFolderPath
    anomalyFilters:
      - fieldName: isSrcDriveShared
        fieldValue: true
  splitFields:
    - srcFolderPath
  historicalData:
    type: count_aggregations
    featureBucketConfName: absoluteSharedFolderPathHistogramUserIdPrintDaily
    featureName: absoluteSharedFolderPathHistogram
  classification: data_exfiltration

- id: sumOfHighestFileExtensionScoresUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_file_extension_print
  adeEventType: scored_enriched.print.fileExtension.userId.print.score
  schema: PRINT
  anomalyDescriptior:
    anomalyField: srcFileExtension
  splitFields:
    - srcFileExtension
  historicalData:
    type: count_aggregations
    featureBucketConfName: fileExtensionHistogramUserIdPrintDaily
    featureName: fileExtensionHistogram
  classification: data_exfiltration

- id: highestNumOfPagesScoreUserIdPrintHourly
  type: SCORE_AGGREGATION
  name: abnormal_number_of_pages_print
  adeEventType: scored_enriched.print.numOfPages.userId.print.score
  schema: PRINT
  anomalyDescriptior:
    anomalyField: numOfPages
  splitFields:
    - numOfPages
  historicalData:
    type: hourly_scored_aggregations
    featureBucketConfName: startInstantToHighestNumOfPagesMapUserIdPrintDaily
    featureName: startInstantToHighestNumOfPagesMap
  classification: data_exfiltration

- id: numberOfSuccessfulPrintsUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_successful_prints
  schema: PRINT
  adeEventType: print
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: SUCCESS
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfFailedPrintsUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_failed_prints
  schema: PRINT
  adeEventType: print
  anomalyDescriptior:
    anomalyField: result
    anomalyValue: FAILURE
  historicalData:
    type: hourly_aggregations
  classification: data_exfiltration

- id: numberOfDistinctSrcMachineIdUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_src_computers_print
  adeEventType: print
  schema: PRINT
  anomalyDescriptior:
    anomalyField: srcMachineId
  historicalData:
    type: hourly_aggregations
  classification: abnormal_print_activity

- id: numberOfDistinctDstMachineIdUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_dst_computers_print
  adeEventType: print
  schema: PRINT
  anomalyDescriptior:
    anomalyField: printerId
  historicalData:
    type: hourly_aggregations
  classification: abnormal_print_activity

- id: numberOfDistinctSrcMachineNameRegexClusterUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_src_computer_clusters_print
  adeEventType: print
  schema: PRINT
  anomalyDescriptior:
    anomalyField: srcMachineNameRegexClusterHistogram
  historicalData:
    type: hourly_aggregations
  classification: abnormal_print_activity

- id: numberOfDistinctDstMachineNameRegexClusterUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_dst_computer_clusters_print
  adeEventType: print
  schema: PRINT
  anomalyDescriptior:
    anomalyField: dstMachineNameRegexClusterHistogram
  historicalData:
    type: hourly_aggregations
  classification: abnormal_print_activity

- id: numberOfDistinctAbsoluteFolderPathUserIdPrintHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_folders_print
  schema: PRINT
  adeEventType: print
  anomalyDescriptior:
    anomalyField: absoluteFolderPathHistogram
  historicalData:
    type: hourly_aggregations
  classification: abnormal_print_activity


#*********************************************************
#*                   PROCESS INDICATORS                  *
#*********************************************************

- id: highestStartInstantScoreUserIdProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_process_day_time
  adeEventType: scored_enriched.process.startInstant.userId.process.score
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: eventDate
  splitFields:
    - eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdProcessDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: numberOfReconnaissanceToolExecutedUserIdProcessHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_reconnaissance_tool_activities_executed
  schema: PROCESS
  adeEventType: process
  anomalyDescriptior:
    anomalyField: dstProcessCategories
    anomalyValue: RECONNAISSANCE_TOOL
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
  historicalData:
    type: hourly_aggregations
  classification: discovery_reconnaissance

- id: sumOfHighestDstProcessFileNameScoresUserIdProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_reconnaissance_tool_executed
  adeEventType: scored_enriched.process.dstProcessFileName.userId.process.score
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: dstProcessFileName
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
      - fieldName: dstProcessCategories
        fieldValue: RECONNAISSANCE_TOOL
  splitFields:
    - dstProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstProcessFileNameHistogramUserIdProcessDaily
    featureName: dstProcessFileNameHistogram
  classification: discovery_reconnaissance

- id: sumOfHighestSrcProcessFilePathScoresUserIdLsassProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_process_injects_into_lsass
  adeEventType: scored_enriched.process.srcProcessFilePath.lsass.process.score
  modelContextFields:
    - dstProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: srcProcessFilePath
    anomalyFilters:
      - fieldName: dstProcessDirectoryGroups
        fieldValue: WINDOWS_SYSTEM32
      - fieldName: dstProcessFileName
        fieldValue: lsass.exe
      - fieldName: operationType
        fieldValue: CREATE_REMOTE_THREAD
  splitFields:
    - srcProcessFileName
    - srcProcessDirectory
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcProcessFilePathHistogramLsassProcessDaily
    featureName: srcProcessFilePathHistogram
  classification: credential_dumping

- id: sumOfHighestSrcProcessFilePathScoresUserIdWindowsProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_process_injects_into_windows_process
  adeEventType: scored_enriched.process.srcProcessFilePath.windowsDstProcessFileName.process.score
  modelContextFields:
    - dstProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: srcProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_REMOTE_THREAD
      - fieldName: dstProcessCategories
        fieldValue: WINDOWS_PROCESS
  splitFields:
    - srcProcessFileName
    - srcProcessDirectory
    - dstProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcProcessFilePathHistogramWindowsDstProcessFileNameProcessDaily
    featureName: srcProcessFilePathHistogram
  classification: process_injection

- id: sumOfHighestSrcProcessFilePathGlobalScoresUserIdScriptingProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_process_executed_a_scripting_tool
  adeEventType: scored_enriched.process.srcProcessFilePath.scriptingDstProcessFileName.process.score
  modelContextFields:
    - dstProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: srcProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
      - fieldName: dstProcessCategories
        fieldValue: SCRIPTING_ENGINE
  splitFields:
    - srcProcessFileName
    - srcProcessDirectory
    - dstProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcProcessFilePathHistogramScriptingDstProcessFileNameProcessDaily
    featureName: srcProcessFilePathHistogram
  classification: powershell_scripting

- id: sumOfHighestDstProcessFilePathCreatedGlobalScoresUserIdScriptingProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_application_triggered_by_scripting_tool
  adeEventType: scored_enriched.process.dstProcessFilePathCreated.scriptingSrcProcessFileName.process.score
  modelContextFields:
    - srcProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: dstProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
      - fieldName: srcProcessCategories
        fieldValue: SCRIPTING_ENGINE
  splitFields:
    - dstProcessFileName
    - dstProcessDirectory
    - srcProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstProcessFilePathCreatedHistogramScriptingSrcProcessFileNameProcessDaily
    featureName: dstProcessFilePathCreatedHistogram
  classification: powershell_scripting

- id: sumOfHighestDstProcessFilePathOpenedGlobalScoresUserIdScriptingProcessHourly
  type: SCORE_AGGREGATION
  name: abnormal_process_opened_by_scripting_tool
  adeEventType: scored_enriched.process.dstProcessFilePathOpened.scriptingSrcProcessFileName.process.score
  modelContextFields:
    - srcProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: dstProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: OPEN_PROCESS
      - fieldName: srcProcessCategories
        fieldValue: SCRIPTING_ENGINE
  splitFields:
    - dstProcessFileName
    - dstProcessDirectory
    - srcProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstProcessFilePathOpenedHistogramScriptingSrcProcessFileNameProcessDaily
    featureName: dstProcessFilePathOpenedHistogram
  classification: powershell_scripting

- id: sumOfHighestSrcProcessFilePathScoresUserIdScriptingProcessHourly
  type: SCORE_AGGREGATION
  name: user_abnormal_process_executed_a_scripting_tool
  schema: PROCESS
  adeEventType: scored_enriched.process.srcProcessFilePath.userIdScriptingDstProcessFileName.process.score
  modelContextFields:
    - userId
    - dstProcessFileName
  anomalyDescriptior:
    anomalyField: srcProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
      - fieldName: dstProcessCategories
        fieldValue: SCRIPTING_ENGINE
  splitFields:
    - srcProcessFileName
    - srcProcessDirectory
    - dstProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: srcProcessFilePathHistogramUserIdScriptingDstProcessFileNameProcessDaily
    featureName: srcProcessFilePathHistogram
  classification: powershell_scripting

- id: sumOfHighestDstProcessFilePathCreatedScoresUserIdScriptingProcessHourly
  type: SCORE_AGGREGATION
  name: user_abnormal_application_triggered_by_scripting_tool
  adeEventType: scored_enriched.process.dstProcessFilePathCreated.userIdScriptingSrcProcessFileName.process.score
  modelContextFields:
    - userId
    - srcProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: dstProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
      - fieldName: srcProcessCategories
        fieldValue: SCRIPTING_ENGINE
  splitFields:
    - dstProcessFileName
    - dstProcessDirectory
    - srcProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstProcessFilePathCreatedHistogramUserIdScriptingSrcProcessFileNameProcessDaily
    featureName: dstProcessFilePathHistogram
  classification: powershell_scripting

- id: sumOfHighestDstProcessFilePathOpenedScoresUserIdScriptingProcessHourly
  type: SCORE_AGGREGATION
  name: user_abnormal_process_opened_by_scripting_tool
  adeEventType: scored_enriched.process.dstProcessFilePathOpened.userIdScriptingSrcProcessFileName.process.score
  modelContextFields:
    - userId
    - srcProcessFileName
  schema: PROCESS
  anomalyDescriptior:
    anomalyField: dstProcessFilePath
    anomalyFilters:
      - fieldName: operationType
        fieldValue: OPEN_PROCESS
      - fieldName: srcProcessCategories
        fieldValue: SCRIPTING_ENGINE
  splitFields:
    - dstProcessFileName
    - dstProcessDirectory
    - srcProcessFileName
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstProcessFilePathOpenedHistogramUserIdScriptingSrcProcessFileNameProcessDaily
    featureName: dstProcessFilePathHistogram
  classification: powershell_scripting

- id: numberOfDistinctReconnaissanceToolExecutedUserIdProcessHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_reconnaissance_tools_executed
  schema: PROCESS
  adeEventType: process
  anomalyDescriptior:
    anomalyField: dstProcessCategories
    anomalyValue: RECONNAISSANCE_TOOL
    anomalyFilters:
      - fieldName: operationType
        fieldValue: CREATE_PROCESS
  historicalData:
    type: hourly_aggregations
  classification: discovery_reconnaissance


- id: numberOfReconnaissanceToolExecutedScoresSumUserIdDstProcessFileNameProcessHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_reconnaissance_tools_executed_process
  schema: PROCESS
  adeEventType: process
  modelContextFields:
    - userId
    - dstProcessFileName
  anomalyDescriptior:
    anomalyField: dstProcessCategories
    anomalyValue: RECONNAISSANCE_TOOL
    anomalyFilters:
    - fieldName: operationType
      fieldValue: CREATE_PROCESS
  splitFields:
    - dstProcessFileName
  historicalData:
    type: hourly_aggregations
    featureName: numberOfReconnaissanceToolExecutedUserIdDstProcessFileNameProcessHourly
  classification: discovery_reconnaissance

#*********************************************************
#*                   REGISTRY INDICATORS                 *
#*********************************************************

- id: highestStartInstantScoreUserIdRegistryHourly
  type: SCORE_AGGREGATION
  name: abnormal_registry_day_time
  adeEventType: scored_enriched.registry.startInstant.userId.registry.score
  schema: REGISTRY
  anomalyDescriptior:
    anomalyField: eventDate
  splitFields:
    - eventDate
  historicalData:
    type: weekday_aggregations
    featureBucketConfName: startInstantHistogramUserIdRegistryDaily
    featureName: startInstantHistogram
  classification: non_standard_hours

- id: sumOfHighestProcessFilePathScoresUserIdRegistryKeyGroupRegistryHourly
  type: SCORE_AGGREGATION
  name: abnormal_process_modified_registry_key_group
  schema: REGISTRY
  adeEventType: scored_enriched.registry.processFilePath.registryKeyGroup.registry.score
  modelContextFields:
    - registryKeyGroup
  anomalyDescriptior:
    anomalyField: processFilePath
    anomalyFilters:
    - fieldName: operationType
      fieldValue: MODIFY_REGISTRY_VALUE
  splitFields:
    - processFileName
    - processDirectory
    - registryKeyGroup
  historicalData:
    type: count_aggregations
    featureBucketConfName: processFilePathHistogramRegistryKeyGroupRegistryDaily
    featureName: processFilePathHistogram
  classification: registry_run_keys


#*********************************************************
#*                   TLS INDICATORS                      *
#*********************************************************

#***************************************
#*             ssl subject             *
#***************************************

- id: numberOfDistinctSrcIpJa3OutboundTlsHourly
  type: FEATURE_AGGREGATION
  name: high_number_of_distinct_outbound_src_ip
  schema: TLS
  adeEventType: tls
  anomalyDescriptior:
    anomalyField: srcIp
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  historicalData:
    type: hourly_aggregations
  classification:

- id: sumOfHighestSslSubjectSrcNetnameOutboundScoresSslSubjectTlsHourly
  type: SCORE_AGGREGATION
  name: abnormal_ssl_subject_for_src_netname_outbound
  adeEventType: scored_enriched.tls.sslSubject.srcNetnameOutbound.tls.score
  modelContextFields:
    - srcNetname
  schema: TLS
  anomalyDescriptior:
    anomalyField: sslSubject
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  splitFields:
    - srcNetname
  historicalData:
    type: count_aggregations
    featureBucketConfName: sslSubjectHistogramSrcNetnameOutboundTlsDaily
    featureName: sslSubjectHistogram
  classification:

- id: sumOfHighestDomainSrcNetnameOutboundScoresSslSubjectTlsHourly
  type: SCORE_AGGREGATION
  name: ssl_subject_abnormal_domain_for_src_netname_outbound
  adeEventType: scored_enriched.tls.domain.srcNetnameOutbound.tls.score
  modelContextFields:
    - srcNetname
  schema: TLS
  anomalyDescriptior:
    anomalyField: domain
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  splitFields:
    - srcNetname
    - domain
  historicalData:
    type: count_aggregations
    featureBucketConfName: domainHistogramSrcNetnameOutboundTlsDaily
    featureName: domainHistogram
  classification:

- id: sumOfHighestDstPortSrcNetnameOutboundScoresSslSubjectTlsHourly
  type: SCORE_AGGREGATION
  name: ssl_subject_abnormal_dst_port_for_src_netname_outbound
  adeEventType: scored_enriched.tls.dstPort.srcNetnameOutbound.tls.score
  modelContextFields:
    - srcNetname
  schema: TLS
  anomalyDescriptior:
    anomalyField: dstPort
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  splitFields:
    - srcNetname
    - dstPort
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstPortHistogramSrcNetnameOutboundTlsDaily
    featureName: dstPortHistogram
  classification:

#***************************************
#*                ja3                  *
#***************************************
- id: sslSubjectSrcNetnameOutboundToHighestScoreMapJa3TlsHourly
  type: SCORE_AGGREGATION
  name: ja3_abnormal_ssl_subject_for_src_netname_outbound
  adeEventType: scored_enriched.tls.sslSubject.srcNetnameOutbound.tls.score
  modelContextFields:
    - srcNetname
  schema: TLS
  anomalyDescriptior:
    anomalyField: sslSubject
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  splitFields:
    - srcNetname
    - sslSubject
  historicalData:
    type: count_aggregations
    featureBucketConfName: sslSubjectHistogramSrcNetnameOutboundTlsDaily
    featureName: sslSubjectHistogram
  classification:

- id: sumOfHighestDstPortSrcNetnameOutboundScoresJa3TlsHourly
  type: SCORE_AGGREGATION
  name: ja3_abnormal_dst_port_for_src_netname_outbound
  adeEventType: scored_enriched.tls.dstPort.srcNetnameOutbound.tls.score
  modelContextFields:
    - srcNetname
  schema: TLS
  anomalyDescriptior:
    anomalyField: dstPort
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  splitFields:
    - srcNetname
    - dstPort
  historicalData:
    type: count_aggregations
    featureBucketConfName: dstPortHistogramSrcNetnameOutboundTlsDaily
    featureName: dstPortHistogram
  classification:

- id: sumOfHighestDomainSrcNetnameOutboundScoresJa3TlsHourly
  type: SCORE_AGGREGATION
  name: ja3_abnormal_domain_for_src_netname_outbound
  adeEventType: scored_enriched.tls.domain.srcNetnameOutbound.tls.score
  modelContextFields:
    - srcNetname
  schema: TLS
  anomalyDescriptior:
    anomalyField: domain
    anomalyFilters:
      - fieldName: direction
        fieldValue: OUTBOUND
  splitFields:
    - srcNetname
    - domain
  historicalData:
    type: count_aggregations
    featureBucketConfName: domainHistogramSrcNetnameOutboundTlsDaily
    featureName: domainHistogram
  classification:

classificationPriority:

- classificationName: credential_dumping
  priority: 1

- classificationName: discovery_reconnaissance
  priority: 2

- classificationName: powershell_scripting
  priority: 3

- classificationName: registry_run_keys
  priority: 4

- classificationName: process_injection
  priority: 5

- classificationName: mass_changes_to_critical_enterprise_groups
  priority: 6

- classificationName: mass_changes_to_groups
  priority: 7

- classificationName: elevated_privileges_granted
  priority: 8

- classificationName: brute_force_authentication
  priority: 9

- classificationName: user_logins_to_multiple_domains
  priority: 10

- classificationName: user_login_to_abnormal_remote_host
  priority: 11

- classificationName: user_login_to_abnormal_host
  priority: 12

- classificationName: data_exfiltration
  priority: 13

- classificationName: mass_file_rename
  priority: 14

- classificationName: snooping_user
  priority: 15

- classificationName: multiple_logons_by_user
  priority: 16

- classificationName: user_logged_into_multiple_hosts
  priority: 17

- classificationName: admin_password_change
  priority: 18

- classificationName: mass_permission_changes
  priority: 19

- classificationName: abnormal_site_access
  priority: 20

- classificationName: abnormal_ad_changes
  priority: 21

- classificationName: abnormal_print_activity
  priority: 22

- classificationName: sensitive_user_status_changes
  priority: 23

- classificationName: print_from_abnormal_host
  priority: 24

- classificationName: abnormal_file_access
  priority: 25

- classificationName: print_to_abnormal_printer
  priority: 26

- classificationName: non_standard_hours
  priority: 27

- classificationName: suspicious_user_activity
  priority: 28
