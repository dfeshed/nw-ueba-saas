{
    "dashboardId": "malware",
    "name": "Malware discovery by DNS Activity Analysis",
    "description": "Malware discovery is being done by automatic analysis of DNS activity from internal communication within the network. This analytics package set run multiple algorithms that seek for abnormal behavior of DNS activity, in order to pinpoint communication of malware with its command and control, using advanced mechanism named DGA (Domain Generation Algorithm).",
    "controls": [
        {
            "type": "search",
            "label": "Search: ",
            "settings": {
                "reports": [
                    {
                        "query": {
                            "searchId": "Search_Machines",
                            "dataSource": "splunk",
                            "options": {
                                "count": 10
                            },
                            "fields": {
                                "Result":{"type":"ip"}
                            },
                            "params": [
                                {
                                    "field": "term",
                                    "type": "string",
                                    "dashboardParam": "term"
                                }
                            ]
                        }
                    }
                ],
                "onSelect": {
                    "action": "innerUrl",
                    "actionOptions": {
                        "url": "/d/malware/e/machine/{{value}}"
                    }
                },
                "placeholder": "IP or machine name"
            }
        }
    ],
    "widgets": [
        {
            "widgetId": 1,
            "reportId": 1,
            "report": {
                "reportId": 1,
                "cache": "15m",
                "name": "Top suspicious machines by score",
                "description": "Get top 10 machines from the last 24h, ordered by score",
                "query": {
                    "dataSource": "splunk",
                    "searchId": "Top_10_Machines",
                    "options": { "count": 10 },
                    "fields": {
                        "IP_Address":{"type":"ip"},
                        "Score":{"type":"float"},
                        "machines.Severity":{"type":"number"}
                    },
                    "params": [
                        {
                            "field": "timeStart",
                            "type": "string",
                            "default": "-7d"
                        },
                        {
                            "field": "timeEnd",
                            "type": "string",
                            "default": "now"
                        },
                        {
                            "field": "head",
                            "type": "number",
                            "default": "10"
                        },
                        {
                            "field": "minScore",
                            "type": "number",
                            "default": "1",
                            "dashboardParam": "topTenScoreFilter"
                        }
                    ]
                }
            },
            "name": "DGA - Top 10 machines",
            "width": "30%",
            "views": [
                {
                    "type": "table",
                    "title": "Top suspicious machines",
                    "style": {
                        "height": "360px"
                    },
                    "settings": {
                        "showIndex": true,
                        "fields": [
                            {
                                "name": "Machine",
                                "value": "{{IP_Address}}",
                                "sortBy": "IP_Address",
                                "link": "#/d/malware/e/machine/{{IP_Address}}",
                                "style": [
                                    {
                                        "properties": {
                                            "color": "#cc0000",
                                            "font-weight": "bold"
                                        },
                                        "conditions": [
                                            {
                                                "field": "Severity",
                                                "operator": "greaterThanOrEqual",
                                                "value": 8
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "Score",
                                "value": "{{Score}}",
                                "sortBy": "Score",
                                "sortDirection": -1,
                                "format": "float",
                                "formatOptions": { "decimals": 2 },
                                "style": [
                                    {
                                        "properties": {
                                            "color": "#cc0000",
                                            "font-weight": "bold"
                                        },
                                        "conditions": [{
                                            "field": "Severity",
                                            "operator": "greaterThanOrEqual",
                                            "value": 8
                                        }]
                                    }
                                ],
                                "filter": {
                                    "type": "number",
                                    "label": "Higher than:",
                                    "dashboardParam": "topTenScoreFilter",
                                    "defaultValue": 1,
                                    "noFilterValue": 0,
                                    "min": 0,
                                    "max": 9,
                                    "maxlength": 5,
                                    "width": 50
                                },
                                "tooltip": "Risk Score that indicates the possibility that a machine is infected with a malware which uses a DGA mechanism to communicate with its controller. 1 being the lowest possibility and 10 the highest."
                            }
                        ]
                    }
                }
            ]
        },
        {
            "widgetId": 2,
            "reportId": 2,
            "refreshOn": ["timeStart"],
            "report": {
                "reportId": 2,
                "cache": "15m",
                "name": "Machine score comparison of top 10 machines",
                "description": "Comparison of the top 10 machines, by score, across time",
                "query": {
                    "dataSource": "splunk",
                    "searchId": "Top_10_Machines_Graph_By_Time",
                    "fields": {
                        "Bucket":{"type":"number"},
                        "IP_Address":{"type":"string"},
                        "Score":{"type":"number"}
                    },
                    "params": [
                        {
                            "dashboardParam": "timeStart",
                            "field": "timeStart",
                            "type": "number",
                            "default": "201305290000"
                        },
                        {
                            "dashboardParam": "timeEnd",
                            "field": "timeEnd",
                            "type": "number",
                            "default": "201305292359"
                        }
                    ]
                }
            },
            "controls": [
                {
                    "type": "dateRange",
                    "label": "For dates:",
                    "updateDataOnChange": true,
                    "params": {
                        "timeStart": "-7d",
                        "timeEnd": "now"
                    },
                    "paramsTransform": {
                        "timeStart": {
                            "type": "stringDate",
                            "regExp": "(\\d{4})-(\\d{2})-(\\d{2})",
                            "replaceWith": "$1$2$30000",
                            "format": "YYYY-MM-DD"
                        },
                        "timeEnd": {
                            "type": "stringDate",
                            "regExp": "(\\d{4})-(\\d{2})-(\\d{2})",
                            "replaceWith": "$1$2$32400",
                            "format": "YYYY-MM-DD"
                        }
                    },
                    "onChange": {
                        "action": "setParams",
                        "actionOptions": {
                            "updateUrl": false,
                            "params": {
                                "timeStart": "{{timeStart}}",
                                "timeEnd": "{{timeEnd}}"
                            },
                            "paramsTransform": {
                                "timeStart": {
                                    "type": "stringDate",
                                    "regExp": "(\\d{4})-(\\d{2})-(\\d{2})",
                                    "replaceWith": "$1$2$30000",
                                    "format": "YYYY-MM-DD"
                                },
                                "timeEnd": {
                                    "type": "stringDate",
                                    "regExp": "(\\d{4})-(\\d{2})-(\\d{2})",
                                    "replaceWith": "$1$2$32400",
                                    "format": "YYYY-MM-DD"
                                }
                            }
                        }
                    }
                }
            ],
            "name": "DGA - Machine score comparison",
            "width": "70%",
            "views": [
                {
                    "type": "lineGraph",
                    "title": "Machine score comparison",
                    "style": {
                        "height": "360px"
                    },
                    "settings": {
                        "graphType": "LineChart",
                        "graphOptions": {
                            "vAxis": { "minValue": 0, "maxValue": 10 }
                        },
                        "useRawData": true,
                        "height": 310,
                        "lineDataField": "items",
                        "axes": {
                            "x": {
                                "field": "Bucket",
                                "values": {
                                    "type": "datetime",
                                    "startAt": "params.timeStart",
                                    "endAt": "params.timeEnd",
                                    "format": "YYYY-MM-DD HH:mm",
                                    "interval": { "value": 15, "unit": "m" },
                                    "transform": {
                                        "regExp": "(\\d{4})(\\d{2})(\\d{2})(\\d{2})(\\d{2})",
                                        "replaceWith": "$1-$2-$3 $4:$5:00"
                                    }
                                }
                            },
                            "y": "Score"
                        },
                        "labels": "IP_Address",
                        "decimals": 2,
                        "events": [
                            {
                                "eventName": "select",
                                "scope": "point",
                                "action": "innerUrl",
                                "actionOptions": {
                                    "url": "/d/malware/e/machine/{{column}}",
                                    "params": {
                                        "timeStart": "{{@timeStart}}",
                                        "timeEnd": "{{@timeEnd}}"
                                    }
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "report": {
                "name": "A machine's score, over time",
                "description": "Get score for all buckets in the specified time range, for the specified machine.",
                "cache": "15m",
                "query": {
                    "dataSource": "splunk",
                    "searchId": "Top_10_Suspicious_Domains",
                    "fields": {
                        "Domain_Name":{"type":"string"},
                        "IP_Address":{"type":"ip"},
                        "Domain_Score":{"type":"float"},
                        "Last_Access":{"type":"date"},
                        "Number_of_Failures":{"type":"number"},
                        "Number_of_Successes":{"type":"number"}
                    },
                    "params": [
                        {
                            "field": "timeStart",
                            "type": "string",
                            "default": "-27d"
                        },
                        {
                            "field": "timeEnd",
                            "type": "string",
                            "default": "now"
                        },
                        {
                            "field": "sort",
                            "type": "string",
                            "default": "-Domain_Score",
                            "dashboardParam": "sort"
                        },
                        {
                            "field": "minScore",
                            "type": "number",
                            "default": "3",
                            "dashboardParam": "domainScoreFilter"
                        },
                        {
                            "field": "minFailures",
                            "type": "number",
                            "default": "1",
                            "dashboardParam": "domainFailuresFilter"
                        },
                        {
                            "field": "head",
                            "type": "number",
                            "default": "1000"
                        }
                    ],
                    "options": {
                        "count": 10
                    }
                }
            },
            "name": "Top 10 suspicious domains",
            "width": "100%",
            "views": [
                {
                    "type": "table",
                    "title": "Top suspicious domains",
                    "settings": {
                        "allowPaging": true,
                        "fields": [
                            {
                                "name": "Domain",
                                "value": "{{Domain_Name}}",
                                "sortBy": "Domain_Name",
                                "events": {
                                    "click": {
                                        "action": "showPopup",
                                        "actionOptions": {
                                            "popupTitle": "Domain - {{Domain_Name}}",
                                            "width": 400,
                                            "height": 260,
                                            "dashboardId": "domain",
                                            "dashboardParams": {
                                                "domain": "{{Domain_Name}}"
                                            }
                                        }
                                    }
                                }
                            },
                            {
                                "name": "Machine",
                                "value": "{{IP_Address}}",
                                "sortBy": "IP_Address",
                                "link": "#/d/malware/e/machine/{{IP_Address}}"
                            },
                            {
                                "name": "Last access",
                                "value": "{{Last_Access}}",
                                "sortBy": "Last_Access",
                                "tooltip": "The last time the domain was accessed"
                            },
                            {
                                "name": "Score",
                                "value": "{{Domain_Score}}",
                                "sortBy": "Domain_Score",
                                "sortDirection": -1,
                                "format": "float",
                                "formatOptions": { "decimals": 2 },
                                "tooltip": "Risk Score that indicates the possibility that a domain serves as a malicious command and control, based on DNS activity analysis of IP addresses. 1 being the lowest possibility and 10 the highest.",
                                "filter": {
                                    "type": "number",
                                    "label": "Higher than:",
                                    "dashboardParam": "domainScoreFilter",
                                    "defaultValue": 3,
                                    "noFilterValue": 0,
                                    "min": 0,
                                    "max": 9,
                                    "maxlength": 5,
                                    "width": 50
                                }
                            },
                            {
                                "name": "Failures",
                                "value": "{{Number_of_Failures}}",
                                "sortBy": "Number_of_Failures",
                                "tooltip": "How many times access to the domain was attempted, but failed",
                                "filter": {
                                    "type": "number",
                                    "label": "At least:",
                                    "dashboardParam": "domainFailuresFilter",
                                    "defaultValue": 1,
                                    "noFilterValue": 0,
                                    "min": 0,
                                    "maxlength": 7,
                                    "width": 50
                                }
                            },
                            {
                                "name": "Successes",
                                "value": "{{Number_of_Successes}}",
                                "sortBy": "Number_of_Successes",
                                "tooltip": "How many times the domain was successfully accessed"
                            }
                        ]
                    }
                }
            ]
        }
    ]
}