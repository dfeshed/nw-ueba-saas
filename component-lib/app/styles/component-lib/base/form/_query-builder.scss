.rsa-query-fragment-dropdown {
  max-width: 17.5rem;
  min-width: 27.5rem;

  li {
    position: relative;
  }
}

.rsa-icon.expensive-operator-indicator {
  display: inline-flex;
  align-self: center;
  margin-right: rsa-whitespace(less);
  color: transparent;
}

.ember-power-select-typeahead-dropdown {
  margin-top: 4px;
  border-color: border-color(neutral, dark)!important;
  @include rsa-font(body, small);

  .rsa-icon.expensive-operator-indicator {
    &.is-expensive {
      color: text-color(primary, lightest);
    }
  }

  &.is-expensive {
    .rsa-icon.expensive-operator-indicator {
      color: text-color(primary, lightest);
    }
  }
}

.rsa-query-meta {
  display: flex;
  align-items: flex-start;
  position: relative;
  flex-wrap: wrap;
  background-color: background-color(primary, darkest, translucent);
  @include border(1px, solid, neutral, dark);
  flex: 1 1 auto;
  max-height: 12rem;
  overflow-x: hidden;
  overflow-y: auto;

  p {
    @include rsa-font(body, small);
    color: text-color(primary, light);
    position: absolute;
    right: rsa-whitespace(less);
    bottom: calc(0px - #{rsa-whitespace()} - #{rsa-whitespace(least)});

    strong {
      color: text-color(primary, lightest);
      font-weight: 700;
    }
  }

  > .controls {
    white-space: nowrap;
    display: none;
    justify-content: flex-end;
    align-content: center;

    i {
      padding: rsa-whitespace(less) rsa-whitespace();
      color: text-color(primary, lightest);

      &:hover {
        cursor: pointer;
        color: text-color(secondary);
      }
    }
  }

  &.queryable {
    .controls {
      display: flex;
    }
  }

  input,
  .ember-power-select-trigger {
    border: none!important;
    @include rsa-font(body, small);
  }

  .rsa-query-fragment {
    display: inline-flex;
    position: relative;
    flex: 0 0 auto;
    align-self: center;
    margin: rsa-whitespace(least);
    border-radius: rsa-whitespace(least);
    @include border(1px, solid, primary);
    color: text-color(primary, lightest);

    .rsa-icon.expensive-operator-indicator {
      color: text-color(primary, lightest);
    }

    &.empty {
      max-width: 1.25rem;
      margin-right: 0;

      .meta {
        padding-right: 0;
      }

      &.typing {
        max-width: inherit;
      }
    }

    &.query-fragment-invalid {
      border-color: border-color(accentOne);
    }

    &:last-of-type {
      max-width: inherit;
      .invisible-edit-trigger {
        display: none;
      }
    }

    &.highlighted {
      border-color: border-color(secondary);
    }

    &.selected:not(.edit-active) {
      background: background-color(secondary);
      border-color: border-color(secondary, dark);

      .delete-filter-fragment {
        color: text-color(primary, lightest);

        &:hover {
          cursor: pointer;
          color: text-color(primary, dark);
        }
      }
    }

    .ember-power-select-trigger {
      width: 100%;
    }

    .invisible-edit-trigger {
      width: 1.85rem;
      position: absolute;
      top: 0;
      bottom: 0;
      left: -1.15rem;
      @include rsa-layer(controls);
      background-color: opacity-value(transparent);
      border-radius: rsa-whitespace(most);

      &:hover {
        cursor: text;
        background-color: background-color(accentTwo, base, translucent)
      }
    }

    .meta,
    .delete-filter-fragment {
      display: inline-flex;
      align-self: center;
    }

    .delete-filter-fragment {
      margin-right: rsa-whitespace(less);
      margin-left: rsa-whitespace(less);
      margin-top: 1px;
      color: text-color(primary);

      &:hover {
        cursor: pointer;
        color: text-color(primary, lightest);
      }
    }

    .meta {
      @include rsa-font(body, small);
      display: block;
      text-align: center;
      padding: rsa-whitespace(less) rsa-whitespace(least) rsa-whitespace(less) rsa-whitespace(less);
    }

    &.edit-active {
      border: none;

      &:not(:last-of-type) {
        flex: 0 0 auto;
      }

      &:last-of-type {
        flex: 1 1 auto;
      }

      .invisible-edit-trigger {
        display: none;
      }
    }

    &.prev-is-editing {
      &:hover {
        .invisible-edit-trigger {
          display: none;
        }
      }
    }
  }
}
