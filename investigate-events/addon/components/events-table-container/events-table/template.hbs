{{#rsa-data-table
  lazy=true
  fitToWidth=true
  items=items
  selectedIndex=selectedIndex
  columnsConfig=extendedColumns
  language=language
  aliases=aliases
  onRowClick=(action 'onRowClick')
  loadLogsAction=(action 'eventsLogsGet')
  scrollToInitialSelectedIndex=true
  enableGrouping=true
  groupingSize=groupingSize
  threshold=threshold
  searchMatches=searchMatches
  searchTerm=searchTerm
  searchScrollIndex=searchScrollIndex
  eventTableFormattingOpts=eventTableFormattingOpts
  visibleColumnsDidChange=(action 'setVisibleColumns')
}}

  {{#rsa-data-table/header
    translateTitles=false
    enableColumnSelector=true as |column|}}
    {{#with (meta-key-alias column.field language) as |names|}}
      {{#if (eq column.field 'checkbox')}}
        <label class="rsa-form-checkbox-label {{if allEventsSelected 'checked'}}">
          {{rsa-form-checkbox
            checked=allEventsSelected
            change=(action 'toggleSelectAllEvents')
          }}
        </label>
      {{else}}
        <h2 class="title" title="{{if column.title column.title names.bothNames}}">
          {{#if (and column.field sortableColumns (not disableSort))}}
            {{#if (contains column.field sortableColumns)}}
              {{#if (eq sortField column.field)}}
                {{#if (eq sortDirection 'Ascending')}}
                  <span class="sort-indicator active" {{action 'toggleSort' column.field}}>
                    {{rsa-icon name="arrow-up-7" size="small"}}
                  </span>
                {{else}}
                  <span class="sort-indicator active" {{action 'toggleSort' column.field}}>
                    {{rsa-icon name="arrow-down-7" size="small"}}
                  </span>
                {{/if}}
              {{else}}
                <span class="sort-indicator" {{action 'toggleSort' column.field}}>
                  {{rsa-icon name="arrow-up-7" size="small"}}
                </span>
              {{/if}}
              <span class="js-move-handle">
                {{if column.title column.title names.displayName}}
              </span>
            {{else}}
              {{#rsa-content-tethered-panel-trigger panel=(concat 'columnSortTooltip' column.displayIndex)}}
                <span class="js-move-handle">
                  {{if column.title column.title names.displayName}}
                </span>
              {{/rsa-content-tethered-panel-trigger}}
            {{/if}}
          {{else}}
            {{#rsa-content-tethered-panel-trigger panel=(concat 'columnSortTooltip' column.displayIndex)}}
              <span class="js-move-handle">
                {{if column.title column.title names.displayName}}
              </span>
            {{/rsa-content-tethered-panel-trigger}}
          {{/if}}

          {{#rsa-content-tethered-panel displayCloseButton=false position='top' panelId=(concat 'columnSortTooltip' column.displayIndex)}}
            <section>
              {{events-table-container/events-table/sort-tooltip
                field=column.field
                disableSort=disableSort
                notIndexedAtValue=notIndexedAtValue
                notSingleton=notSingleton
                notValid=notValid
              }}
            </section>
          {{/rsa-content-tethered-panel}}
        </h2>
      {{/if}}
    {{/with}}
  {{/rsa-data-table/header}}

  {{events-table-container/body-container
    buffer=5
    selectedItems=selectedEventIds
    allItemsSelected=allEventsSelected
    rowComponentClass="events-table-container/row-container"
    noResultsMessage=noResultsMessage
  }}

  {{!--
    Utilizing load-more to take advantage of its ability to
    stick itself to the right place in the DOM
   --}}
  {{#rsa-data-table/load-more}}
    {{!-- still streaming, show loader --}}
    {{#if areEventsStreaming}}
      <div class='events-table-footer-status'>
        {{#if hasPartialResults}}
          {{t 'investigate.partialResults' totalCount=totalCount actualEventCount=actualEventCount}}
        {{else if (or isQueryExecutedByColumnGroup isQueryExecutedBySort)}}
          {{rsa-loader size='large' label=(t 'investigate.reExecutingQuery')}}
        {{else}}
          {{rsa-loader size="large" label=(t 'investigate.loading')}}
        {{/if}}
      </div>
    {{else if (is-equal status 'complete')}}
      {{#if (not allExpectedDataLoaded)}}
        {{!-- do not have all the data, say so --}}
        {{t 'investigate.notAllLoaded' maxEvents=maxEvents}}
      {{else if hasResults}}
        <div class='events-table-footer-status'>
          {{t 'investigate.allResultsLoaded'}}
        </div>
      {{/if}}
    {{else if hasPartialResults}}
      {{#if isEventResultsError}}
        {{t 'investigate.partialResultsWithError' totalCount=totalCount actualEventCount=actualEventCount}}
      {{else if isCanceled}}
        {{t 'investigate.partialResults' totalCount=totalCount actualEventCount=actualEventCount}}
      {{/if}}
    {{/if}}
  {{/rsa-data-table/load-more}}

{{/rsa-data-table}}
