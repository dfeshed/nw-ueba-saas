# Flume agent for the adapter component
# The source reads data from Netwitness SDK within a given time range
# Date format: yyyy-mm-ddTHH:mm:ss 2015-01-01T00:00:01Z
# Channel stores in file up to 10K records
# The sinks writes the records using the input SDK
###################################### AGENT #####################################################
nwAuthenticationAgent.sources=sdkSource
nwAuthenticationAgent.channels=memoryChannel
nwAuthenticationAgent.sinks=inputSdkSink
###################################### SOURCE #####################################################
nwAuthenticationAgent.sources.sdkSource.channels=memoryChannel
nwAuthenticationAgent.sources.sdkSource.streamImplClassName=presidio.nw.flume.sdk.NetwitnessEventsStream
nwAuthenticationAgent.sources.sdkSource.type=org.flume.source.sdk.PresidioStreamingSDKSource
nwAuthenticationAgent.sources.sdkSource.schema=AUTHENTICATION
nwAuthenticationAgent.sources.sdkSource.startDate=$startDate
nwAuthenticationAgent.sources.sdkSource.endDate=$endDate
# nwAuthenticationAgent.sources.sdkSource.query=select event.time,sessionid,alias.host,reference.id,host.src,user.dst,event.type,result.code,event.source.id,host.dst,service.name,logon.type,device.type,event.cat.name,ec.activity,ec.outcome,analysis.service,event.desc,action,user.src,result where ((device.type = 'winevent_nic','winevent_snare') && ((reference.id = '4624','4625' && logon.type = '2','10') || (reference.id = '4769' && service.name regex '.*\\$$') || (reference.id = '4648')) && (user.dst regex '^[^\\$]*$')) || ((device.type = 'rsaacesrv') && (ec.activity = 'Logon')) || ((action = '/usr/sbin/sshd' || action='/usr/bin/login') && device.type = 'rhlinux')
nwAuthenticationAgent.sources.sdkSource.query=select event.time,sessionid,alias.host,reference.id,host.src,user.dst,event.type,result.code,event.source.id,host.dst,service.name,logon.type,device.type,event.cat.name,ec.activity,ec.outcome,analysis.service,event.desc,action,user.src,result where ((reference.id = '4624','4625','4769','4648') || (device.type = 'rsaacesrv' && ec.activity = 'Logon') || ((action = '/usr/sbin/sshd' || action='/usr/bin/login') && device.type = 'rhlinux'))
nwAuthenticationAgent.sources.sdkSource.timeField=event.time
nwAuthenticationAgent.sources.sdkSource.batchSize=1000
nwAuthenticationAgent.sources.sdkSource.isBatch=true
nwAuthenticationAgent.sources.sdkSource.applicationName=adapter
nwAuthenticationAgent.sources.sdkSource.socketTimeout=600
########## INTERCEPTORS ORDER ########
nwAuthenticationAgent.sources.sdkSource.interceptors=transformerInterceptor
nwAuthenticationAgent.sources.sdkSource.interceptors.transformerInterceptor.type=org.apache.flume.interceptor.presidio.transform.TransformerInterceptor$Builder
nwAuthenticationAgent.sources.sdkSource.interceptors.transformerInterceptor.configuration_path=/var/lib/netwitness/presidio/flume/conf/adapter/transformers/authentication.json
###################################### CHANNEL #####################################################
nwAuthenticationAgent.channels.memoryChannel.type=memory
nwAuthenticationAgent.channels.memoryChannel.capacity=100000
nwAuthenticationAgent.channels.memoryChannel.transactionCapacity=10000
###################################### SINK #####################################################
nwAuthenticationAgent.sinks.inputSdkSink.channel=memoryChannel
nwAuthenticationAgent.sinks.inputSdkSink.type=org.flume.sink.input.PresidioInputSdkSink
nwAuthenticationAgent.sinks.inputSdkSink.schema=AUTHENTICATION
nwAuthenticationAgent.sinks.inputSdkSink.recordType=presidio.sdk.api.domain.rawevents.AuthenticationRawEvent
nwAuthenticationAgent.sinks.inputSdkSink.isBatch=true
nwAuthenticationAgent.sinks.inputSdkSink.batchSize=1000
nwAuthenticationAgent.sinks.inputSdkSink.applicationName=adapter
