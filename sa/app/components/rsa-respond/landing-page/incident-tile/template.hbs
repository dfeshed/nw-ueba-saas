
<hbox class="rsa-incident-tile-header">
  {{rsa-update-indicator model=incident isIconOnly=true onTile=true updateKey='asyncUpdate'}}

  {{#if isLargeSize}}
    <vbox class='rsa-incident-tile-header-info' xs='3'>
      {{rsa-content-badge-score label=(t 'incident.fields.riskScore') class="rsa-incident-tile-score" score=incident.riskScore style=badgeStyle}}
    </vbox>

    <vbox class='rsa-incident-tile-header-info' xs='9'>
      <ul class="rsa-incident-top">
        <li class="rsa-incident-tile-id-header">
          <label class="rsa-incident-tile-id">{{unbound incident.id}}</label>
        </li>
        <li class="rsa-incident-tile-name" title={{if isNameCropped incident.name}}>
          {{incidentName}}
        </li>
        <li class={{concat 'rsa-incident-tile-status' (unless editModeActive ' read-only')}}>
          <span class="label-text">
            {{t 'incident.fields.status'}}
          </span>
          {{#unless editModeActive}}
            <span class='rsa-incident-tile-status-selector'>{{t (concat 'incident.status.' selectedStatus) }}</span>
          {{else}}
            {{#power-select
              class='rsa-incident-tile-status-selector'
              tagName='span'
              options=statusList
              selected=selectedStatus
              allowClear=false
              searchEnabled=false
              onchange=(action (mut selectedStatus))
              as |status|}}
              {{t (concat 'incident.status.' status) }}
            {{/power-select}}
          {{/unless}}
        </li>
      </ul>
    </vbox>
  {{else}}
    <vbox class='rsa-incident-tile-header-info' xs='2'>
      {{rsa-content-badge-score class="rsa-incident-tile-score" score=incident.riskScore size=(if isQueue "smaller" "small") style=badgeStyle}}
    </vbox>

    <vbox class='rsa-incident-tile-header-info' xs='10'>
      <ul class="rsa-incident-top">
        <li class="rsa-incident-tile-id-header">
          <label class="rsa-incident-tile-id">{{unbound incident.id}}</label>
        </li>
        <li class="rsa-incident-tile-name" title={{if isNameCropped incident.name}}>
          {{incidentName}}
        </li>
      </ul>
    </vbox>
  {{/if}}
</hbox>

{{#if isLargeSize}}
  <hbox class="rsa-incident-tile-section">
    <vbox xs="6">
      {{#rsa-content-definition class='rsa-incident-tile-priority' label=(t 'incident.fields.priority')}}
        {{#unless editModeActive}}
          <span class='rsa-incident-tile-priority-selector'>{{t (concat 'incident.priority.' selectedPriority) }}</span>
        {{else}}
          {{#power-select
            class="rsa-incident-tile-priority-selector"
            tagName='div'
            options=priorityList
            selected=selectedPriority
            allowClear=false
            searchEnabled=false
            onchange=(action (mut selectedPriority))
            as |priority|}}
            {{t (concat 'incident.priority.' priority) }}
          {{/power-select}}
        {{/unless}}
      {{/rsa-content-definition}}
    </vbox>

    <vbox xs="6">
      {{#rsa-content-definition class='rsa-incident-tile-assignee' label=(t 'incident.fields.assignee')}}
        {{#unless editModeActive}}
          <span class='rsa-incident-tile-assignee-selector'>
            {{#if (eq selectedAssignee.id -1)}}
              {{t 'incident.assignee.none'}}
            {{else}}
              {{selectedAssignee.name}}
            {{/if}}
          </span>
        {{else}}
          {{#power-select
            class='rsa-incident-tile-assignee-selector'
            tagName='div'
            options=usersList
            selected=selectedAssignee
            allowClear=false
            searchEnabled=false
            onchange=(action (mut selectedAssignee))
            as |user|}}
            {{#if (eq user.id -1)}}
              {{t 'incident.assignee.none'}}
            {{else}}
              {{user.name}}
            {{/if}}
          {{/power-select}}
        {{/unless}}
      {{/rsa-content-definition}}
    </vbox>
  </hbox>
{{/if}}

{{#if isQueue}}
  <hbox class="rsa-incident-tile-section">
    <vbox xs="5" class="rsa-incident-tile-status-col">
      <div>
        {{#rsa-content-definition class="rsa-incident-tile-status-block" label=(t "incident.fields.status")}}
          <label class="rsa-incident-tile-status">{{t (concat 'incident.status.' selectedStatus) }}</label>
        {{/rsa-content-definition}}
      </div>
    </vbox>

    <vbox xs="3">
      {{#rsa-content-definition class="rsa-incident-tile-priority-block" label=(t "incident.fields.priority")}}
        <label class="rsa-incident-tile-priority">{{t (concat 'incident.priority.' selectedPriority) }}</label>
      {{/rsa-content-definition}}
    </vbox>
    <vbox xs="4">
      {{#rsa-content-definition class="rsa-incident-tile-assignee-block" label=(t "incident.fields.assignee")}}
        <label class="rsa-incident-tile-assignee">{{if incident.assignee incident.assignee.name (t 'incident.assignee.none')}}</label>
      {{/rsa-content-definition}}
    </vbox>
  </hbox>
{{else}}
  <hbox class="rsa-incident-tile-section">
    <vbox xs="6" class="rsa-incident-tile-alert-col">
      <div>
        {{#if isLargeSize}}
          {{#rsa-content-definition class="rsa-incident-tile-alert-block" label=(t "incident.fields.alertCount")}}
            <label class="rsa-incident-tile-alert-count">{{if incident.alertCount incident.alertCount '-'}}</label>
          {{/rsa-content-definition}}

          {{#rsa-content-definition class="rsa-incident-tile-event-block" label=(t "incident.fields.events")}}
            <label class="rsa-incident-tile-event-count">{{if incident.eventCount incident.eventCount '-'}}</label>
          {{/rsa-content-definition}}
        {{else}}
          {{#rsa-content-definition class="rsa-incident-tile-priority-block" label=(t "incident.fields.priority")}}
            <label class="rsa-incident-tile-priority">{{t (concat 'incident.priority.' incident.prioritySort)}}</label>
          {{/rsa-content-definition}}
          {{#rsa-content-definition class="rsa-incident-tile-alert-block" label=(t "incident.fields.alertCount")}}
            <label class="rsa-incident-tile-alert-count">{{if incident.alertCount incident.alertCount '-'}}</label>
          {{/rsa-content-definition}}
        {{/if}}
      </div>
    </vbox>
    <vbox xs="6">
      {{rsa-content-ip-connections showPlaceHolder=true fromIPs=incident.groupBySourceIp toIPs=incident.groupByDestinationIp}}
    </vbox>
  </hbox>
  {{#if isLargeSize}}
    <hbox class="rsa-incident-tile-section">
      <vbox xs="6">
        {{#rsa-content-definition label=(t "incident.fields.sources")}}
          <div class='rsa-incident-tile-sources'>
            {{#each incidentSources as |source|}}
              {{rsa-content-label label=source}}
            {{/each}}
          </div>
        {{/rsa-content-definition}}
      </vbox>
    </hbox>
  {{/if}}
{{/if}}
{{#if contextualTimestamp}}
  <hbox class="rsa-incident-tile-section">
    <vbox xs="12" class="rsa-incident-tile-created-col">
      <span class="rsa-incident-tile-created-date">{{t (if isIncidentNew 'incident.fields.createdTimestamp' 'incident.fields.updatedTimestamp')}}{{rsa-content-datetime timestamp=contextualTimestamp}}{{rsa-content-datetime timestamp=contextualTimestamp asTimeAgo=true}}</span>
    </vbox>
  </hbox>
{{/if}}

{{#rsa-form-button click=(action 'editButtonClick') isIconOnly=true class='rsa-edit-tool' }}
  {{rsa-icon name=(if editModeActive 'check-1' 'pencil-1')}}
{{/rsa-form-button}}
